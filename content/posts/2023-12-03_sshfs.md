---
title: "sshfs"
date: 2023-12-03
draft: true
tags: ["ssh", "sshfs"]
slug: sshfs
---

# How to mount remote machine's directory on current host?

这个问题最初源于我想要用 Kate 来编辑一个位于 macOS 上的配置文件。我正常 ssh in 到 macOS，cd 到那个 directory，然后输出 `kate <file>` 试图打开那个文件进行编辑。这时候发现没有 kate 这个命令，噢，因为我在 macOS 的环境下，当然没有 kate 了。但这是个问题，难不成我只能使用 vi 来编辑 remote 的文件？我看 Asahi Lina 在开发的时候，都是非常顺畅的用 Kate 打开她身边各个 Mac machine 里的项目、文件，编辑来编辑去。一定有什么方法可以办到。

### Mount at user directory (under `$HOME`).

This command works:

`sshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/`

It will not block current terminal, and the mounted filesystem will be accessible at `~/Desktop/remote-filesystem/`. Unmonut this via `fusermount -u remote-filesystem` or `sudo umount remote-filesystem`.

After mounting, the user and group for directory `~/Desktop/remote-filesystem` will become `501` and `games`, here is the explaination of this from Claude.ai:

> The user and group IDs you are seeing (501 and games) correspond to the user and primary group ownership of the mounted Mac directory on the Linux side.
>
> On macOS, each user is assigned a UID (user ID) and GID (group ID). The first user created gets UID/GID 501 by default. And the primary group for users is normally the staff group, which has the GID of 20.
>
> However, when you mount the Mac directory onto your Linux system using SSHFS, it does not map the macOS user and group names to Linux users and groups. Instead, it just exposes the raw numeric IDs from macOS.
>
> So the user ID 501 and group ID games (which is probably 20) simply represent the macOS owner and group of the mounted directory. The names are shown as the numeric values since your Linux system does not have equivalently named users or groups defined.
>
> This is expected behavior with SSHFS. The ownership stays the same numerically, but the names do not map over. Everything should still work properly, but you just see the raw IDs instead of translated names in the Linux listing.

---

`sshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/ -d`

If add `-d` flag, it will print debug info, which will consequently block current trminal. It will print something like this:

```sh
$ sshfs mbp:/Users/thom/Desktop/ ~/Desktop/remote-filesystem/ -d
SSHFS version 3.7.3
executing <ssh> <-x> <-a> <-oClearAllForwardings=yes> <-2> <mbp> <-s> <sftp>
Server version: 3
Extension: posix-rename@openssh.com <1>
Extension: statvfs@openssh.com <2>
Extension: fstatvfs@openssh.com <2>
Extension: hardlink@openssh.com <1>
Extension: fsync@openssh.com <1>
Extension: lsetstat@openssh.com <1>
Extension: limits@openssh.com <1>
Extension: expand-path@openssh.com <1>
Extension: copy-data <1>
Extension: home-directory <1>
Extension: users-groups-by-id@openssh.com <1>
[00001] EXTENDED
[00002] EXTENDED
  [00001] EXTENDED_REPLY       97bytes (5ms)
  [00002] EXTENDED_REPLY       97bytes (5ms)
[00003] LSTAT
  [00003]          ATTRS       41bytes (87ms)
[00004] LSTAT
  [00004]         STATUS       33bytes (8ms)
[00005] LSTAT
  [00005]         STATUS       33bytes (4ms)
[00006] LSTAT
  [00006]         STATUS       33bytes (5ms)
[00007] OPENDIR
  [00007]         HANDLE       17bytes (33ms)
```

You can still use `fusermount -u remote-filesystem` and `sudo umount remote-filesystem` to unmount it, once you unmount it, the debug info printing will stop:

```sh
...
[00015] LSTAT
  [00015]         STATUS       33bytes (5ms)

sent:               15 messages, 485 bytes
received:           15 messages, 1613 bytes
rtt min/max/avg:    4ms/106ms/16ms
num connect:        1
```

Additionally, you can pass `-v` to it: `sshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/ -d -v`. According to `man sftp`, the effect of `-v` is:

> -v      Raise logging level.  This option is also passed to ssh.

Let's further look at the man page of ssh `man ssh`:

> -v      Verbose mode.  Causes ssh to print debugging messages about its progress.  This is helpful in debugging connection, authentication, and configuration problems.  Multiple -v options increase the verbosity.  The maximum is 3.

But anyway, it is doubtful whether this flag is effective in this case.

### Mount at `/mnt`

This command also works (without `sudo`):

`sshfs mbp:/Users/thom/ /mnt/remote-filesystem/`

但是即便我没有给 allow_other 的 flag 给它：`-o allow_other`，在 mount point 我还是可以作为一个普通 user cd 进去：`cd /mnt/remote-filesystem`。

仍然，`/mnt/remote-filesystem` 的 user 和 group 为 501 和 games。

---

Some reference man page deserve to be further investigate:

- `man sshfs`
- `man sftp`
- `man mount.fuse`
- `man fusermount`
