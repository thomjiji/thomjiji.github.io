[{"content":"比如你想把 Konsole 和 Firefox 这些最最常用的 app pin 底部的 bar/dock 上（实际上 KDE 叫它 Panel），最直观的，你下意识的右键 Task Manager 上已经打开的 app，这里有一个“Pin to Task Manager”的选项，勾选上它。但这好像不是你想要的，因为你发现即使 pin 上去了，只要你打开那个 app 的一个 instance，那个刚刚被你 pin 上去的 app 就又不见了。这似乎不是你期待中的“pin”。这时你想要打开那个 app 的第二个 instance，就没法去到老地方，你最初 pin 它的那个地方打开。得找到现在的正在运行的那个 instance 所在的 Task Manager 的地方，右键 \u0026gt; \u0026ldquo;Open a New Window\u0026rdquo;。\n其实，你刚刚 pin 上去的那个地方，是 Task Manager 的区域。Task Manager 外层还有一个区域，叫作 Panel。你应该，或者说你其实想把它 pin 到 Panel 上。这样不管你开几个 instance，那个 app 的图标还是在那，当你想开第 n+1 的 instance 的时候，还是去那个 pin 的地方点一下就行了。\n总的来说，KDE 底部栏的层级是这样的：\nPanel: Application Launcher Pager Task Manager System tray Digital clock Peak at Desktop 你其实想把 Konsole 和 Firefox pin 到这里:\nPanel: Application Launcher Pager Konsole Firefox Task Manager System tray Digital clock Peak at Desktop 而不是：\nPanel: Application Launcher Pager Task Manager Konsole Firefox System tray Digital clock Peak at Desktop 这样做：\n按一下 Meta 键，启动 Application Launcher，搜索你想要 pin 的 app，右键； Add to Panel (Widget). Done. Reference:\nPanel - KDE UserBase What\u0026rsquo;s the difference between \u0026ldquo;Add to Panel (Widget)\u0026rdquo; and \u0026ldquo;Pin to Task Manager\u0026rdquo; in KDE Plasma 5? ","permalink":"https://thomjiji.github.io/posts/2023/12/pin-apps-to-kde-panel/","summary":"比如你想把 Konsole 和 Firefox 这些最最常用的 app pin 底部的 bar/dock 上（实际上 KDE 叫它 Panel），最直观的，你下意识的右键 Task Manager 上已经打开的 app，这里有一个“Pin to Task Manager”的选项，勾选上它。但这好像不是你想要的，因为你发现即使 pin 上去了，只要你打开那个 app 的一个 instance，那个刚刚被你 pin 上去的 app 就又不见了。这似乎不是你期待中的“pin”。这时你想要打开那个 app 的第二个 instance，就没法去到老地方，你最初 pin 它的那个地方打开。得找到现在的正在运行的那个 instance 所在的 Task Manager 的地方，右键 \u0026gt; \u0026ldquo;Open a New Window\u0026rdquo;。\n其实，你刚刚 pin 上去的那个地方，是 Task Manager 的区域。Task Manager 外层还有一个区域，叫作 Panel。你应该，或者说你其实想把它 pin 到 Panel 上。这样不管你开几个 instance，那个 app 的图标还是在那，当你想开第 n+1 的 instance 的时候，还是去那个 pin 的地方点一下就行了。\n总的来说，KDE 底部栏的层级是这样的：\nPanel: Application Launcher Pager Task Manager System tray Digital clock Peak at Desktop 你其实想把 Konsole 和 Firefox pin 到这里:","title":"Pin apps to KDE Panel, not KDE Task Manager"},{"content":"How to mount remote machine\u0026rsquo;s directory on current host? 这个问题最初起源于我想要用 Kate 来编辑一个位于 macOS 上的配置文件。我正常 ssh in 到 macOS，cd 到那个 directory，然后输入 kate \u0026lt;file\u0026gt; 试图打开那个文件进行编辑的时候，发现欸？没有 kate 这个命令。噢，因为我是在 macOS 的环境下啊，当然没有 kate 了。但这是个问题，难不成我只能使用 vi 来编辑 remote 的文件？我看 Asahi Lina 在开发的时候，都是非常顺畅的用 Kate 打开她身边各个 Mac machine 里的项目、文件，编辑来编辑去。一定有什么方法可以办到。\n原来就有 sshfs 这个命令，可以把 remote 的 directory mount 到当前的 localhost 上。然后就可以正常在 local 的环境下，cd 到那个 mount point，用 local 的编辑器，不管是 Kate、VS Code 也好，vi/vim 也可以，来编辑文件等等。所有的操作都是在 remote 上，即使表面看起来像是我在一个 local 的文件夹下编辑一个 local 的文件。\nUsing sshfs mount remote directory at $USER directories (under $HOME). sshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/\nAfter running this, the remote filesystem will be accessible locally at ~/Desktop/remote-filesystem/. It can be unmounted using either fusermount -u remote-filesystem or sudo umount remote-filesystem.\nAfter mounting with sshfs, the user and group for directory ~/Desktop/remote-filesystem will change to 501 and games. Here is the explaination of this from Claude.ai:\nThe user and group IDs you are seeing (501 and games) correspond to the user and primary group ownership of the mounted Mac directory on the Linux side.\nOn macOS, each user is assigned a UID (user ID) and GID (group ID). The first user created gets UID/GID 501 by default. And the primary group for users is normally the staff group, which has the GID of 20.\nHowever, when you mount the Mac directory onto your Linux system using SSHFS, it does not map the macOS user and group names to Linux users and groups. Instead, it just exposes the raw numeric IDs from macOS.\nSo the user ID 501 and group ID games (which is probably 20) simply represent the macOS owner and group of the mounted directory. The names are shown as the numeric values since your Linux system does not have equivalently named users or groups defined.\nThis is expected behavior with SSHFS. The ownership stays the same numerically, but the names do not map over. Everything should still work properly, but you just see the raw IDs instead of translated names in the Linux listing.\nJust be aware that the user and group will differ from what you may expect based on your local filesystem.\nsshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/ -d\nAdding the -d flag will enable debug mode and print debugging information, consequently blocking the current terminal session as long as the process is running. The debugging info looks like this:\n$ sshfs mbp:/Users/thom/Desktop/ ~/Desktop/remote-filesystem/ -d SSHFS version 3.7.3 executing \u0026lt;ssh\u0026gt; \u0026lt;-x\u0026gt; \u0026lt;-a\u0026gt; \u0026lt;-oClearAllForwardings=yes\u0026gt; \u0026lt;-2\u0026gt; \u0026lt;mbp\u0026gt; \u0026lt;-s\u0026gt; \u0026lt;sftp\u0026gt; Server version: 3 Extension: posix-rename@openssh.com \u0026lt;1\u0026gt; Extension: statvfs@openssh.com \u0026lt;2\u0026gt; Extension: fstatvfs@openssh.com \u0026lt;2\u0026gt; Extension: hardlink@openssh.com \u0026lt;1\u0026gt; Extension: fsync@openssh.com \u0026lt;1\u0026gt; Extension: lsetstat@openssh.com \u0026lt;1\u0026gt; Extension: limits@openssh.com \u0026lt;1\u0026gt; Extension: expand-path@openssh.com \u0026lt;1\u0026gt; Extension: copy-data \u0026lt;1\u0026gt; Extension: home-directory \u0026lt;1\u0026gt; Extension: users-groups-by-id@openssh.com \u0026lt;1\u0026gt; [00001] EXTENDED [00002] EXTENDED [00001] EXTENDED_REPLY 97bytes (5ms) [00002] EXTENDED_REPLY 97bytes (5ms) [00003] LSTAT [00003] ATTRS 41bytes (87ms) [00004] LSTAT [00004] STATUS 33bytes (8ms) [00005] LSTAT [00005] STATUS 33bytes (4ms) [00006] LSTAT [00006] STATUS 33bytes (5ms) [00007] OPENDIR [00007] HANDLE 17bytes (33ms) You can still use fusermount -u remote-filesystem and sudo umount remote-filesystem to unmount it, once you unmount it, the debug info printing will stop:\n... [00015] LSTAT [00015] STATUS 33bytes (5ms) sent: 15 messages, 485 bytes received: 15 messages, 1613 bytes rtt min/max/avg: 4ms/106ms/16ms num connect: 1 Additionally, you can pass -v to it: sshfs mbp:/Users/thom/ ~/Desktop/remote-filesystem/ -d -v. According to man sftp, the effect of -v is:\n-v Raise logging level. This option is also passed to ssh.\nLet\u0026rsquo;s dig more deep, take a closer look at the ssh man page man ssh:\n-v Verbose mode. Causes ssh to print debugging messages about its progress. This is helpful in debugging connection, authentication, and configuration problems. Multiple -v options increase the verbosity. The maximum is 3.\nBut anyway, it is doubtful whether this flag is effective in this case.\nUsing sshfs mount remote directory at /mnt (root directory) This command also works (without sudo):\nsshfs mbp:/Users/thom/ /mnt/remote-filesystem/\n但是即便我没有给 allow_other 的 flag 给它：-o allow_other，在 mount point (in this case /mnt/remote-filesystem/ directory) 我还是可以作为一个普通 user cd 进去：cd /mnt/remote-filesystem。\n仍然，/mnt/remote-filesystem 的 user 和 group 为 501 和 games。\nThe reason you can use fusermount -u remote-filesystem and sudo umount remote-filesystem to unmount remote filesystem\u0026hellip;sshfs 跟 FUSE filesystem 有什么关系？\nman sshfs:\nTo mount a filesystem: sshfs [user@]host:[dir] mountpoint [options] To unmount it: fusermount3 -u mountpoint # Linux umount mountpoint # OS X, FreeBSD man mount.fuse:\nFUSE filesystems are unmounted using the fusermount(1) command (fusermount -u mountpoint).\nSome reference man page deserve to be further investigate:\nman sshfs man sftp man mount.fuse man fusermount ","permalink":"https://thomjiji.github.io/posts/2023/12/sshfs/","summary":"How to mount remote machine\u0026rsquo;s directory on current host? 这个问题最初起源于我想要用 Kate 来编辑一个位于 macOS 上的配置文件。我正常 ssh in 到 macOS，cd 到那个 directory，然后输入 kate \u0026lt;file\u0026gt; 试图打开那个文件进行编辑的时候，发现欸？没有 kate 这个命令。噢，因为我是在 macOS 的环境下啊，当然没有 kate 了。但这是个问题，难不成我只能使用 vi 来编辑 remote 的文件？我看 Asahi Lina 在开发的时候，都是非常顺畅的用 Kate 打开她身边各个 Mac machine 里的项目、文件，编辑来编辑去。一定有什么方法可以办到。\n原来就有 sshfs 这个命令，可以把 remote 的 directory mount 到当前的 localhost 上。然后就可以正常在 local 的环境下，cd 到那个 mount point，用 local 的编辑器，不管是 Kate、VS Code 也好，vi/vim 也可以，来编辑文件等等。所有的操作都是在 remote 上，即使表面看起来像是我在一个 local 的文件夹下编辑一个 local 的文件。\nUsing sshfs mount remote directory at $USER directories (under $HOME).","title":"sshfs"},{"content":"TL;TR Solved by this command: gpg-connect-agent updatestartuptty /bye \u0026gt;/dev/null.\nhttps://superuser.com/q/1631020/1865466\n事发经过 Holy shit!!! 就在刚刚解决了一个实在令人头疼的问题。MBP 的 SSH 突然坏了，一直报这个错：\nsign_and_send_pubkey: signing failed for ED25519 \u0026#34;(none)\u0026#34; from agent: agent refused operation 因为我用的是 GPG key 来做 SSH 的 authentication，第一时间就是重启 gpg-agent：\ngpgconf --kill gpg-agent gpgconf --launch gpg-agent 通常来说这样一下就又好了，之前好几次我都是这样解决的。但这次完全就没用。它这里说的“agent refused operation”，这个 agent 应该指的是 gpg-agent，所以第一时间想到重启它。但没用的话，又找是不是 ssh-agent 的问题。按道理来说我用 gpg key 来做 ssh authentication 的话，跟 ssh-agent 没啥关系。事实也是，我回到用 ssh key 来 auth 的话就没问题。输入 ssh key 的 passphase 可以正常连接。一通排查，问题就感觉出在 gpg-agent 身上。但什么蛛丝马迹也没有。gpg-agent 也都正常运行着。通过 gpg-connect-agent reloadagent /bye 和 ps aux | grep gpg-agent 检查了，然后又 kill 了几遍 gpg-agent，还是没用。\n一时间都有点怀疑人生，这几天学 SSH，补习 GPG，是不是还是对它们的工作原理存在一些什么误解，哪个步骤没设置对。在出问题之前，其实我还是在看关于 .ssh、.gnupg 文件夹自身的权限问题，应该把它们设置成什么权限，总的来说就是：\nchmod 700 .ssh chmod 600 .ssh/* .gnupg directory 按道理也一样。\n我回想起里，在第一案发时间，我是在改动 .gnupg 的权限：我把这个文件夹里面的所有内容也都改成了 600 权限，根据 Arch wiki 的推荐。但我后来看这个文件夹默认不是这样的，然后就照着我另一台 Fedora Asahi Remix 上的 .gnupg 文件夹又改回去了。主要是那几个 ssh-agent socket 文件本来是具有执行权限的。于是我又把它们的执行权限加了回去。按道理来说这样啥也没变。我又开始怀疑这个改动是不是冥冥之中改了点什么其他东西。这就又摸不着头脑\u0026hellip;\n最后合理怀疑是 TTY 呼不出来了，呼不出来就没法输入 passphrase 来验证，gpg-agent 验证不了，拿不到解密后的 private key 就只能报错了。\nman gpg-agent:\nNote: in case the gpg-agent receives a signature request, the user might need to be prompted for a passphrase, which is necessary for decrypting the stored key. Since the ssh-agent protocol does not contain a mechanism for telling the agent on which display/terminal it is running, gpg-agent\u0026rsquo;s ssh-support will use the TTY or X display where gpg-agent has been started. To switch this display to the current one, the following command may be used:\ngpg-connect-agent updatestartuptty /bye\nAlthough all GnuPG components try to start the gpg-agent as needed, this is not possible for the ssh support because ssh does not know about it. Thus if no GnuPG tool which accesses the agent has been run, there is no guarantee that ssh is able to use gpg-agent for authentication. To fix this you may start gpg-agent if needed using this simple command:\ngpg-connect-agent /bye\nssh-agent 协议不包括告诉 agent 在哪个显示器/终端上运行的机制，于是 gpg-agent 的 ssh-support 将使用启动 gpg-agent 的那个 TTY。（用那个 tty 作为 passphrase 输入窗口的 prompting？）\n用 gpg key 来做 ssh 的 authentication，ssh 就需要与 gpp-agent 建立一个稳定的沟通途径。但 ssh 这边没有一个机制可以直接“呼出”gpg-agent，就像其他 GPG 组件一样。所以任务就来到你这边，你需要确保 gpg-agent 正确运行了，ssh 才能用它来成功建立 authentication。\n","permalink":"https://thomjiji.github.io/posts/2023/12/gpg-agent-does-not-work-anyway/","summary":"Solved by this command: gpg-connect-agent updatestartuptty /bye \u0026gt;/dev/null","title":"gpg-agent doesn't work anyway!"},{"content":"/etc/btrbk/btrbk.conf config file:\nvolume / snapshot_dir btrbk_snapshots subvolume home incremental strict Key points:\nvolume /: \u0026ldquo;Base path within a btrfs filesystem containing the subvolumes to be backuped (usually the mount-point of a btrfs filesystem mounted with subvolid=5 option).\u0026rdquo; In this case, we use the existing root directory — which is already a btrfs filesystem (by default on Fedora). btrbk refer this / (next to volume) as \u0026ldquo;\u0026lt;volume-directory\u0026gt;\u0026rdquo;. snapshot_dir btrbk_snapshots: btrbk_snapshots is relative to the volume set above, which in this case the / (root directory). So the full path of btrbk_snapshots will be /btrbk_snapshots, which located just under the root directory. It\u0026rsquo;s like the \u0026ldquo;destination\u0026rdquo; of snapshots. subvolume home: home is also relative to / which set above. It\u0026rsquo;s the \u0026ldquo;source\u0026rdquo; of snapshots. There are also a target field can be set: target /mnt/btrbk_backup, but it\u0026rsquo;s optional. The target is where the \u0026ldquo;backup\u0026rdquo; subvolumes to be created (refer to the man page of btrbk.conf via man btrbk.conf), while the snapshot_dir is where \u0026ldquo;snapshot\u0026rdquo; to be stored. incremental strict: which means \u0026ldquo;non-incremental (initial) backups are never created\u0026rdquo; (man btrbk.conf). What is snapshot?\nEvery Btrfs snapshot is a subvolume. However, not every subvolume is a snapshot. The difference is in what the subvolume contains. A snapshot is a subvolume with added content: it holds references to current and/or past versions of files (inodes). — Working with Btrfs – Snapshots | Snapshots in Btrfs\n似乎，btrbk 说的 snapshot 指的是与原系统 filesystem 存储在一起的 snapshot，而 backup 指的是在另一个独立的 filesystem 下的 snapshot。与原 filesystem 存在一起的 snapshot 不能称作是一个 backup，因为如果原 filesystem 炸了，那么 snapshot 一起完蛋。而 backup 这时候可以发挥作用了，因为它是存在另一个 filesystem 下的，一般来说是存在另一个盘上，这样才是 backup。以下是 btrbk man page 对 btrfs snapshot 和 btrbk snapshot 区别的简短说明：\nNote that in btrfs terminology, a snapshot is a “subvolume with a given initial content of the original subvolume” (showing a parent-uuid, see btrfs-subvolume(8)), and they can be read-write (default) or read-only. In btrbk terminology, snapshot means “read-only btrfs snapshot”, and backup means “read-only subvolume created with send/receive” (showing a received-uuid). — man btrbk\n可以得知，btrbk 创建的 snapshot 默认是 readonly 的，btrfs 默认是 read 和 write。而 btrbk 的 backup 的概念为：使用 btrfs send 和 btrfs receive 命令创建的 readonly 的 snapshot （sumvolume），而 send/receive 命令一般来说用于在不同 btrfs 文件系统之间移动 snapshots，可以说就是在不同盘之间移动数据。因此，我们上面的理解与 btrbk 的说明相符。\nbtrbk.conf 的 target 就是 backup 存放的地方，而 snapshot_dir 顾名思义是 snapshot 存放的地方。\nReferences:\nWorking with Btrfs – General Concepts — Fedora Magazine Working with Btrfs – Subvolumes — Fedora Magazine Working with Btrfs – Snapshots — Fedora Magazine Working with Btrfs – Compression — Fedora Magazine Incremental backups with Btrfs snapshots — Fedora Magazine Recover your files from Btrfs snapshots — Fedora Magazine ","permalink":"https://thomjiji.github.io/posts/2023/12/btrfs-and-btrbk/","summary":"/etc/btrbk/btrbk.conf config file:\nvolume / snapshot_dir btrbk_snapshots subvolume home incremental strict Key points:\nvolume /: \u0026ldquo;Base path within a btrfs filesystem containing the subvolumes to be backuped (usually the mount-point of a btrfs filesystem mounted with subvolid=5 option).\u0026rdquo; In this case, we use the existing root directory — which is already a btrfs filesystem (by default on Fedora). btrbk refer this / (next to volume) as \u0026ldquo;\u0026lt;volume-directory\u0026gt;\u0026rdquo;. snapshot_dir btrbk_snapshots: btrbk_snapshots is relative to the volume set above, which in this case the / (root directory).","title":"btrfs and btrbk"},{"content":"Useful commands:\ngpg --export-ssh-key \u0026lt;uid\u0026gt;: Retrieve public key part of GPG/(used for) SSH (authentication) key. ssh-add --apple-use-keychain killall ssh-agent gpg --export --armor 3921648AF0ADA1F6 gpg -K --keyid-format long --with-keygrip gpgconf --launch gpg-agent: Launch gpg-agent manually. ps aux | grep \u0026lt;gpg-agent|ssh-agent\u0026gt;: Check if gpg-agent/ssh-agent is running. set -x SSH_AUTH_SOCK $(gpgconf --list-dirs agent-ssh-socket): Tell SSH how to access gpg-agent by setting environment variable SSH_AUTH_SOCK. ssh-add -L: Get SSH key fingerprint. gpgconf --kill gpg-agent ssh-agent -k: Kill the current running ssh-agent. Configure SSH to use GPG agent for authentication:\necho $SSH_AUTH_SOCK: Check current SSH_AUTH_SOCK, it may look like /private/tmp/com.apple.launchd.BhS0P6FUJX/Listeners on Mac. set -x SSH_AUTH_SOCK $(gpgconf --list-dirs agent-ssh-socket): Change that environment variable (SSH_AUTH_SOCK) to tell SSH how to access gpg-agent. Rerun echo $SSH_AUTH_SOCK, it should output: /Users/thom/.gnupg/S.gpg-agent.ssh gpgconf --launch gpg-agent: Now, launch gpg-agent. If it\u0026rsquo;s not working (when we check by using ssh -T git@github.com failed), kill the current running gpg-agent: gpgconf --kill gpg-agent. Try gpg-agent --daemon/gpgconf --launch gpg-agent instead. OR use reload agent command: gpg-connect-agent reloadagent /bye. (Reference) ssh-add -L: Use this command to check current identities. You can see it\u0026rsquo;s activated. It should output something like: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILPHzucXNBTMScAYA84tNcCs53L2WmveAVOZDuEP3x8p (none) This ⬆️ can be retrieved via gpg --export-ssh-key \u0026lt;uid\u0026gt;. Retrieve SSH Key passphrase from Apple Keychain and add it to the ssh-agent for SSH authentication:\nssh-add -L: Check current ssh-agent authentication state. ssh-add --apple-use-keychain: Add SSH private key to the ssh-agent using passphrase stored in the keychain. ssh -T git@github.com: Test connection. Done. How to setup GPG for SSH authentication:\nEdit ~/.gnupg/gpg-agent.conf file, echo \u0026quot;enable-ssh-support\u0026quot; \u0026gt;\u0026gt; ~/.gnupg/gpg-agent.conf. Create a subkey for authentication only, after creations, your keyring should look like this: $ gpg -K --keyid-format long --with-keygrip sec rsa2048 2019-03-21 [SC] [expires: 2021-03-20] 96F33EA7F4E0F7051D75FC208715AF32191DB135 Keygrip = P68H43D8SEHZ45P9PJYX9VEQP3EPAK30SCGY6I17 uid [ultimate] Brian Rebort ssb rsa2048 2019-03-21 [E] [expires: 2021-03-20] Keygrip = VUJ6OZ29NSGI1EIH373GKR90N0EMNOH1XWMHXO9C ssb rsa2048 2019-03-21 [A] Keygrip = 5U368R3PTB3E88LWW6PWMU6TG61C4GIYIAF68S3P Take a note of the newly created subkey\u0026rsquo;s keygrip, then: cat 5U368R3PTB3E88LWW6PWMU6TG61C4GIYIAF68S3P \u0026gt;\u0026gt; ~/.gnupg/sshcontrol. Lastly, change the environment variable SSH_AUTH_SOCK to the socket GPG agent setup for SSH communication: set -x SSH_AUTH_SOCK $(gpgconf --list-dirs agent-ssh-socket). How to setup SSH Key for SSH authentication:\nConnect with SSH | Checking for existing SSH keys Knowledge:\n$SSH_AUTH_SOCK contains the path of the unix file socket that the agent uses for communication with other processes. This is essential for ssh-add.\n$SSH_AUTH_SOCK : Identifies the path of a UNIX-domain socket used to communicate with the agent.\nWhen you run ssh-add, it communicates with the authentication agent (whether it\u0026rsquo;s ssh-agent or gpg-agent acting as an SSH agent) via the specified socket, and that\u0026rsquo;s what the SSH_AUTH_SOCK environment variable is used for.\nThe gpgconf --list-dirs agent-ssh-socket command is used to display the directory where the GnuPG (GPG) agent\u0026rsquo;s UNIX domain socket for SSH operations is located.\nReference:\nHow to enable SSH access using a GPG key for authentication: Entry point for this topic/technique. GPG - SSH setup: more comprehensive. SSH key - Arch Wiki GnuPG - Arch Wiki OpenSSH - Arch Wiki ","permalink":"https://thomjiji.github.io/posts/2023/11/gpg-for-ssh-authentication/","summary":"Using GPG key for ssh authentication reduces the effort involved in managing SSH keys, which is the main reason I want to learn this technique. GPG key for all (not just one GPG key possibly).","title":"GPG key for SSH authentication"},{"content":"生成一个 SSH key 最简单的生成一个 ssh key 的方法：ssh-keygen -C \u0026quot;my ssh key\u0026quot;\n-c: comment. Provides a comment for this key. 较常用的生成一个 ssh key 的方法（自定义 key 的类型/算法）：ssh-keygen -t ed25519 -C \u0026quot;my ssh key\u0026quot;\n-t: Specify the type of the key to create. The possible values are “dsa”, “ecdsa”, “ecdsa-sk”, “ed25519”, “ed25519-sk”, or “rsa”.. Public Key Access:\nA user creates a pair of public and private keys, and installs the public key in his $HOME/.ssh/authorized_keys file on the target server. 然后这个 public key 对应的 private key 的所有者（的设备/machine）就可以随意访问这个 target server 了。 A public key consist of: type key (itself) comment For example: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEMucCYHaP8lU+zBeeP6ps7DsT7ViZCvWK1UOiaNaSyg mbp Public Key Access with Agent support\nPublic Key Access with Agent Forwarding\nauthorized_keys:\nUser: The \u0026ldquo;authorized_keys\u0026rdquo; file on the remote server is used for manage \u0026ldquo;who\u0026rdquo; can access to that server, right?\nChatGPT: Exactly, that\u0026rsquo;s correct. The authorized_keys file on the remote server is used to manage access by specifying which public keys are allowed to connect to a particular user\u0026rsquo;s account on that server. Each line in the authorized_keys file typically represents a public key that is authorized to access the associated user account. By adding or removing public keys in this file, administrators can control and manage who has permission to log in to the server using SSH.\nThe file ~/.ssh/authorized_keys lists the public keys that are permitted for logging in. When the user logs in, the ssh program tells the server which key pair it would like to use for authentication. The client proves that it has access to the private key and the server checks that the corresponding public key is authorized to accept the account. — man ssh | AUTHENTICATION\n如果我尝试 access 一台 remote server，但我本地没有配置任何 ssh key，.ssh 文件夹都是空的。这个时候 authentication fall back 为 username/password access。你需要输入 remote server 的 login password 来 ssh in。\nssh-add: add my ssh private key to ssh-agent。让 ssh-agent 来保管我的 private key。这个命令需要你输入 ssh private key 的 passphrase。 ssh-add -l: Lists fingerprints of all identities currently represented by the agent. 列出当前被添加到 ssh-agent 的 ssh (private) key 的 fingerprint。 SSH_AUTH_SOCK environment variable: Identifies the path of a UNIX-domain socket used to communicate with the agent.\n所有可以在 ~/.ssh/config 文件里设置的东西，都在 man ssh_config 里。\nSSH authentication methods (Authentication methods are tried in the order specified below):\nHost-based authentication: Host-based authentication works as follows: If the machine the user logs in from is listed in /etc/hosts.equiv or /etc/ssh/shosts.equiv on the remote machine, the user is non-root and the user names are the same on both sides, or if the files ~/.rhosts or ~/.shosts exist in the user\u0026rsquo;s home directory on the remote machine and contain a line containing the name of the client machine and the name of the user on that machine, the user is considered for login. Public key authentication Keyboard-interactive authentication: The server sends an arbitrary \u0026ldquo;challenge\u0026rdquo; text and prompts for a response, possibly multiple times. Password authentication To allow access for only specific users:\nEdit this file: /etc/ssh/sshd_config. Append AllowUsers user1 user2 to it. ⬆️ This keyword can be followed by a list of user name patterns, separated by spaces.\nMore info can be fonud in sshd_config man page: man sshd_config.\nssh automatically maintains and checks a database containing identification for all hosts it has ever been used with（所以 known_host 文件包含的是内容是这个意思）。Any new hosts are automatically added to the user\u0026rsquo;s file (known_host file).\nReference An Illustrated Guide to SSH Agent Forwarding OpenSSH - Arch Wiki https://infosec.mozilla.org/guidelines/openssh ","permalink":"https://thomjiji.github.io/posts/2023/11/ssh-notes/","summary":"生成一个 SSH key 最简单的生成一个 ssh key 的方法：ssh-keygen -C \u0026quot;my ssh key\u0026quot; -c: comment. Provides a comment for this key. 较常用的生成一个 ssh key 的方法（自定义 key 的类型/算法）：ss","title":"SSH notes"},{"content":"Notes du * 输出的其实不是我们通常理解上的文件大小，而是所谓 block size（block count 可能更准确）。而且，它显示的是 disk usage，也就是这个文件占了多大的硬盘容量，或者说文件系统实际分配了多少空间给到这个文件。而不是，这个文件，它本身有多大。这个区别比较关键，后面会有更多的说明。\n$ du * 5568\t1-2-1_2frames_ap4h.mov 8040\t1-2-1_2frames_ap4x.mov 3928\t1-2-1_2frames_apch.mov 2152\t1-2-1_2frames_apcn.mov 688\t1-2-1_2frames_apco.mov 1592\t1-2-1_2frames_apcs.mov 我们使用 exa 这个 ls 的替代，用 exa -lh -b -S 这个命令得到这样的输出：\n$ exa -lh -b -S Permissions Size Blocks User Date Modified Name .rw-r--r--@ 2.7Mi 5568 thom 27 Oct 17:32 1-2-1_2frames_ap4h.mov .rw-r--r--@ 3.9Mi 8040 thom 27 Oct 17:32 1-2-1_2frames_ap4x.mov .rw-r--r--@ 1.9Mi 3928 thom 27 Oct 17:32 1-2-1_2frames_apch.mov .rw-r--r--@ 1.0Mi 2152 thom 27 Oct 17:32 1-2-1_2frames_apcn.mov .rw-r--r--@ 342Ki 688 thom 27 Oct 17:32 1-2-1_2frames_apco.mov .rw-r--r--@ 793Ki 1592 thom 27 Oct 17:32 1-2-1_2frames_apcs.mov -l: Display extended file metadata as a table. -h: Add a header row to each column. -b: List file sizes with binary prefixes. --binary. -S: List each file’s number of file system blocks. 可以看到 Blocks 那一栏跟 du * 的输出是一样的。-S 的 flag 的作用也正是列出 file system blocks。\n使用 du -k * 会得到以下的输出：\n$ du -k * 2784\t1-2-1_2frames_ap4h.mov 4020\t1-2-1_2frames_ap4x.mov 1964\t1-2-1_2frames_apch.mov 1076\t1-2-1_2frames_apcn.mov 344\t1-2-1_2frames_apco.mov 796\t1-2-1_2frames_apcs.mov -k: Display block counts in 1024-byte (1 KiB) blocks. 可以看到这回输出的数字又跟上面的不一样了。我们 pass -k 这个 flag 给到 du，是让 du 把 1024 个 byte 当作是一个 block，然后告诉我们这个文件一共有多少个 1024 bytes 的 block。\n我们可以把输出的这一串数字当作是 KiB，因为 1024 bytes = 1KiB。要得到 bytes 的话，把它们分别乘以 1024 就可以了，比如第一个文件 1-2-1_2frames_ap4h.mov 显示为 2784：2784 * 1024 bytes = 2850816 bytes。\n但使用 Finder 查看第一个文件会发现，字节数跟我们计算出来的不太一样，Finder 显示的是：2849756。2850816 - 2849756 = 1060，相差了 1060 个 bytes。这是为什么呢？\n上面的 du * 命令，不 pass 任何 flag 的，则是把 512 个 byte 当作一个 block，告诉我们这个文件有多少个 512 bytes 的 block。这是 macOS 上 du 命令的默认值，默认的 block size。而在 Linux 上，或者你在 macOS 上使用 GNU du（gdu），默认值则是 1024 bytes。\nexa -lh -B -S 得到与 Finder 匹配的字节数 bytes，其中 -B 的意思是 List file sizes in bytes, without any prefixes.\nexa -lh -b -S 得到二进制下的 MiB：2.8Mi。\nexa -lh -S 不 pass -b 或 -B 得到与 Finder 匹配的 MB：2.8M。但有可能由于四舍五入位数的不同而导致比如 Finder 显示 64.6MB，这里显示 65M。\nexa -lh -B -S: bytes exa -lh -b -S: binary prefix exa -l: exa default to decimal prefix with this command. du 输出的是 block size。什么是 block size 呢，就是文件系统 file system 实际分配给这个文件的空间。而其他命令比如说 exa -lh -b -S 输出的结果是所谓 apparent size（表面上的大小），就是这个文件看上去应该是这么大（看上去应该是占据了这么多的空间）。也就是说，一个文件的 metadata 里显示的我这个文件的大小（表面上的大小，apparent size），“我这个文件是这么大哦”，与实际上文件系统分配给（allocate）给它的空间，“我只分配给你这么多空间，因为你只需要这么多空间”，可以是不同的，是两码事。\n为什么呢？因为有一种叫做 sparse file 的存在。就是你说你要占据这么多的空间，但实际上你拿这么多空间来存储的都是 0，你没往里面写入数据。使用 dd if=/dev/null of=big bs=1 count=0 seek=2G 命令可以生成一个 apparent size 是 2 GiB，实际上文件系统分配给它的空间是 0 的文件。因为这个 command 实际上没有写入任何数据到那个文件当中去。或者你可以生成一个文件，先写入 1 MiB 的数据到文件的最开头，再写入 1 MiB 的数据到文件的最末尾，然后中间什么都不写入，是空的。那么文件系统会把这个文件记做只占据 2 MiB 空间，只分配 2 MiB 给它。然后它实际上也只占据了 2 MiB。\nmacOS 自带的 du 命令的行为实在是太奇怪了，要么 flags 跟 GNU 的 du 不一样，非得自己改一下，改个别的名，比如 GNU du 要显示 apparent size 的话，pass --apparent-size flag：du --apparent-size --block-size 1 *；macOS du 要显示 apparent size 的话，pass -A flag。但关键的来了，这个 -A 它不 work！\n对于 macOS du 来说，du -A -B 1 * 对应着 GNU du 的 du --apparent-size --block-size 1 *。是吧，就功能上来说，-A 对应 --apparent-size，-B 对应 --block-size。这边 GNU du 的 du --apparent-size --block-size 1 * 输出结果为：\n64606136\tA100_001_20231023.mov 118636627\tA100_002_20231023.mov 99361921\tA100_003_20231023.mov 但 macOS du 的 du -A -B 1 * 输出结果为：\n126184\tA100_001_20231023.mov 231713\tA100_002_20231023.mov 194067\tA100_003_20231023.mov 它输出的仍然是 disk usage 而不是 apparent size，而且输出的这个数字还是 block size 为 512 bytes 下的 block count，而不是我 pass 给它的 1，要求它输出 block size 为 1 bytes 下的 block count——也就是所有的 bytes（bytes 就是它二者相乘得到的：block size * block count = total bytes）。相当于这两个 flag 都不 work。\n认为 GNU du 输出的那三个数字是对的的原因，是与其他命令交叉比对得到的结果：diskus -b A100_002_20231023.mov, exa -lh -B -S。\n所以咱直接不用 macOS 自带的 du 了，可以 brew install coreutils，里面就有纯正的原生的 du，告别 macOS 魔改过的 du。\n最后，记住这几个 command 就可以了：\ndu --si *: --si, like -h (human readable), but use powers of 1000 not 1024. du -b *: -b equivalent to --apparent-size --block-size=1. exa -lh -B -S: -l: Display extended file metadata as a table. -h: Add a header row to each column. -B: List file sizes in bytes, without any prefixes. -S: List each file’s number of file system blocks. Use block size 512 bytes actually. diskus: diskus -b --size-format binary \u0026lt;file\u0026gt; diskus -b --size-format decimal \u0026lt;file\u0026gt; 查看所在的盘的文件系统的 block size：stat -f %k .\ngdu -sh --block-size 1 \u0026lt;file\u0026gt;: disk usage gdu -sh -b \u0026lt;file\u0026gt;: apparent size diskus 为了与 du 的行为匹配，默认使用 disk usage。要查看文件的 apparent size，pass -b flag：\n$ diskus -b \u0026lt;file\u0026gt; 64.61 MB (64,606,136 bytes) $ diskus \u0026lt;file\u0026gt; 64.61 MB (64,606,208 bytes) gdu 默认的 block size 是 1024，du 默认是 512。所以当不 pass 任何 flag 给到它们两个命令时：\n$ du A100_001_20231023.mov 126184\tA100_001_20231023.mov $ gdu A100_001_20231023.mov 63092\tA100_001_20231023.mov 这里显示的数字是 block count 的意思。有这么多 block，在分别以 block size 为 512 和 1024 bytes 的情况下。du 输出的数字 126184 的意思是：这里有 126184 个 512 bytes 大小的 block。gdu 输出的数字 63092 的意思是：这里有 63092 个 1024 bytes 大小的 block。所以最终的 bytes 字节数：\n126184 * 512 = 64606208 bytes 63092 * 1024 = 64606208 bytes 这里都是 disk usage。\nStandards Prefix IEC 60027 binary prefix The SI prefixes decimal prefix 严格来说，标准定义的用来表示计量单位的倍数的前缀当中，没有 KB 这种写法，应该写做 kB。这是 10 进制下的。而对于 2 进制倒是有 KiB（大写 “K”），这是标准的写法。然后如果去掉后面的 “B” 的话，对于 10 进制也应该写做小写的 k 而不是 K（但是这里有一个奇葩），对于 2 进制的话则写做 Ki。其他前缀比如 mega、giga，mebi、gibi 等，也是同样的逻辑。\nReference Binary and Decimal Prefixes - Wolfprojects Binary prefix - Wikipedia Decimal and Binary Prefixes - Blocks and Files du invocation (GNU Coreutils 9.4) ","permalink":"https://thomjiji.github.io/posts/2023/11/file-size/","summary":"Notes du * 输出的其实不是我们通常理解上的文件大小，而是所谓 block size（block count 可能更准确）。而且，它显示的是 disk usage，也就是这个文件占了多大的硬盘容量，或者说文件系统实际分配了多少空间给到这个文件。而不是，这个文件，它本身有多大。这个区别比较关键，后面会有更多的说明。\n$ du * 5568\t1-2-1_2frames_ap4h.mov 8040\t1-2-1_2frames_ap4x.mov 3928\t1-2-1_2frames_apch.mov 2152\t1-2-1_2frames_apcn.mov 688\t1-2-1_2frames_apco.mov 1592\t1-2-1_2frames_apcs.mov 我们使用 exa 这个 ls 的替代，用 exa -lh -b -S 这个命令得到这样的输出：\n$ exa -lh -b -S Permissions Size Blocks User Date Modified Name .rw-r--r--@ 2.7Mi 5568 thom 27 Oct 17:32 1-2-1_2frames_ap4h.mov .rw-r--r--@ 3.9Mi 8040 thom 27 Oct 17:32 1-2-1_2frames_ap4x.mov .rw-r--r--@ 1.9Mi 3928 thom 27 Oct 17:32 1-2-1_2frames_apch.","title":"File size"},{"content":"Excerpted from learncpp.com\npreprocessor .cpp file =\u0026gt; preprocessor: Make change to the text of the code file, but not actually to the original code file, rather temporarily in-memory or using temporary files. Uninteresting things: strip out comments, ensures each code file ends in a newline. One important role: process#include directives. =\u0026gt; What comes out of the preprocessor is called translation unit. The translation unit is then compiled by the compiler. +--------+ +---------------------+ +-------------------+ +-----------------+ | .cpp | =\u0026gt; | Preprocessor | =\u0026gt; | Translation Unit | =\u0026gt; | Compiled output | | file | | | | | | (object code) | +--------+ +---------------------+ +-------------------+ +-----------------+ | /----\u0026gt; |#include files | \u0026lt;\\ | | | / |Macro expansion | \\ | | | / |Remove comments | \\ | | | / |Add line-breaks | \\ | | | / |etc. | \\ | | +-- Original file +--Processes the file +--Output from +--Binary code resulted with directives preprocessor from compilation (processed code) The entire process of preprocessing, compiling and linking is called translation.\npreprocessor directives Preprocessor directives (often just called directives) are instructions that start with a # symbol and end with a newline (NOT a semicolon).\n#include When you #include a file, the preprocessor replaces the #include directive with the contents of the included file. The included contents are then preprocessed recursively.\nMacro defines In C++, a macro is a rule that defines how input text is converted into replacement output text.\nObject-like macros Function-like macros Object-like macros:\n#define identifier #define identifier substitution_text Object-like macros (with substitution text) When the preprocessor encounters this directive, any further occurrence of the identifier is replaced by substitution_text.\nObject-like macros (without substitution text) #define USE_YEN Any further occurrence of the identifier is removed and replaced by nothing.\nIt seems pretty useless, but the common use of it is below.\nConditional compilation The conditional compilation preprocessor directives allow you to specify under what conditions something will or won’t compile.\n#ifdef ifndef endif #include \u0026lt;iostream\u0026gt; #define PRINT_JOE int main() { #ifdef PRINT_JOE std::cout \u0026lt;\u0026lt; \u0026#34;Joe\\n\u0026#34;; // will be compiled since PRINT_JOE is defined #endif #ifdef PRINT_BOB std::cout \u0026lt;\u0026lt; \u0026#34;Bob\\n\u0026#34;; // will be excluded since PRINT_BOB is not defined #endif return 0; } The scope of #define Directives are only valid from the point of definition to the end of the file in which they are defined.\n","permalink":"https://thomjiji.github.io/posts/2023/09/cpp-preprocessor/","summary":"Excerpted from learncpp.com\npreprocessor .cpp file =\u0026gt; preprocessor: Make change to the text of the code file, but not actually to the original code file, rather temporarily in-memory or using temporary files. Uninteresting things: strip out comments, ensures each code file ends in a newline. One important role: process#include directives. =\u0026gt; What comes out of the preprocessor is called translation unit. The translation unit is then compiled by the compiler. +--------+ +---------------------+ +-------------------+ +-----------------+ | .","title":"C++ Preprocessor"},{"content":"Apple Developer Documentation Storing and sharing media with QuickTime files Color parameter atom (\u0026lsquo;colr\u0026rsquo;) Uncompressed Y´CbCr Video in QuickTime Files — Documentation Archive Other resources Apple ProRes - MultiMedia Wiki QuickTime Tags - ExifTool MPEG-4 files - Atomic Parsley MP4RA - Official Registration Authority for the ISOBMFF family of standards Implementations/tools Implementations Language Notes metacolor.editor C# Simple Implementation, can only change NCLC tags. Provide GUI. qtff-parameter-editor C++ Good implementation, can only change NCLC tags. CLI. AMCDXVideoPatcherCLI C++ Close source. Can modify colr atom, add gama atom (but value of gamma can\u0026rsquo;t not be changed — seems a bug) qtfile_pp C++ AMCDXVideoPatcherCLI 作者的开源 parser，想必 AMCDXVideoPatcherCLI 的具体实现能够从这里看出一些端倪 dryv Rust No docs bento4 C++ 最完善 Inspection tools hexdump -vC fq MP4Box.js - a file inspection tool mp4analyser Notes 这么些处理 atom (包括 NCLC tag) 的实现，都是用 C++ 写的。其实 Rust 也能做这些 low-level 的事情，对吗？只是这门语言比较新，暂时还没有人用它来做这个事而已。那么我能不能来做呢？用 Rust 写一个 parse MOV file format 的实现。其实已经有了：dryv——这两天就在更新。\n这需要对 low-level 底层的东西有足够的了解是吗？底层的东西我又不太会。但这无疑是一个机会和切入点，就像 Asahi Lina 在她的哪一个 stream 说的，她最开始入门 low-level 编程也是为了要 hack 任天堂的一个什么掌机。我需要写一个 parse QuickTime file 的 Rust 的实现，实现出来一定挺酷。\n进一步的说，其他的一些元数据，比如时码、卷号，这些在 DIT 工作当中会碰到的需要对其做一些操作的元数据。现有的达芬奇、Pomfort 之流没有提供类似的功能，或者需要你进入到一整个流程当中，才能实现对某个文件修改元数据的需求。我可以做一个 goto 的锋利小工具。目前市面上有 QTchange，但它卖的挺贵，29.95 欧。上面提到的 AMCDXVideoPatcher 的 GUI 好像连卷名也能修改。就真的好想知道具体是怎么办到的，可惜它没有公开源码，不过相比 QTchange 这个免费还要啥自行车。\n我导出两个片段，一个 1-1-1，一个 1-2-1。除此之外其他一切都一样。最后使用 hexdump 查看两个文件的字节数 bytes 大小，发现相差 12 bytes，而 gama atom 恰好就是 12 bytes。差的就是这个 gama atom。\nDecode ProRes: RDD 36:2015 - SMPTE Registered Disclosure Doc - Apple ProRes Bitstream Syntax and Decoding Process。这个标准专门讲解了如何 decode ProRes 的 file stream。而且，不能只修改 mov 这个 container 的 colr atom，还要修改 ProRes header 里的 Primaries, Transfer Function and Matrix 信息：\nIn addition to the colour information carried within the Color Atom, information regarding the transfer function, colour matrix and primaries are also stored within the frame header information of the ProRes elementary stream, alongside other parameters, such as frame rate, spatial resolution and chroma format. This header is repeated throughout the bitstream. Full details of the header layout can be found in the SMPTE specification.\nA lot of work to do\u0026hellip;\n这里有两个 colr_atom-ish 的地方，一个是 MOV file format 本身的 colr atom，一个是 ProRes 编码的每一帧的 header（ProRes header）：也是由 color primaries、transfer characteristic 和 matrix coefficients 组成。所以，如果想要实现修改 NCLC tag，不仅需要修改 colr atom（MOV file format 里的），还要修改每一帧的那三个东西。MOV file format 的 colr atom 三个 tag 各占 2 bytes（u16），ProRes frame 的三个 tag 每个只占 1 byte（u8）。\nIt looks like: 只有 Transfer characteristics 是 Unspecified 的状态，gama atom 才会起作用。如果 Transfer characteristics 是有值的，比如 BT.709，那么即使有 gama atom，比如使用 Mediainfo 查看 Gamma 为 2.4，也是不起作用的。ColorSync utility 仍然只会以 Transfer characteristics 为准，而忽略 gama atom。确实像之前听到别人所说，gama atom 像是 Apple 提供的一个后门，一个 hacking ColorSync 的迂回办法。\n今天（2023-09-30）实现了 overwriting colr atom，search 的算法还是用的之前的，因为之前的算法虽然的 debug build 下非常慢，但只要换到有优化的 release build 之后就非常快了（其实也不算非常快，只能说还算可以接受）。所以就先用着，继续实现后面的功能。\ngama atom 这个东西的 FourCC (four character code) 是 67 61 6d 61。具体的值紧随其后，比如 00 02 66 66 — Gamma 2.4，00 02 33 33 — Gamma 2.2。如果要修改 Gamma 值，直接 overwrite 这 4 个 byte 就行了。QuickTime File Format 一个 2001 的 PDF 文档也说明 gama atom 是个 32-bit 的 fixed-point number，也就是占 4 个 byte。如果需要去掉 gama atom，那么将那 4 个 byte 用 00 00 00 00 overwrite 掉即可。这样的话，当我们需要把 1-2-1 转换到 1-1-1 的时候，首先修改 atom，然后去掉 gama atom。去掉 gama atom 的方法算是找到了。但是问题是如何添加上 gama atom，这可能才是我们想要的。目前没找到合适的方法让 gama atom 无中生有，添加一个 gama atom 到整个 file stream。难道要 shift 所有其他 bytes？\n做 byte search 的话，会 match 到两个 gama atom 的 pattern。更奇怪的是，对于 1-1-1 的文件，它没有 gama atom，但也能 match 到 gama atom 的那个 pattern：\n$ grep \u0026#34;gama\u0026#34; 1-1-1_20mins_hex.txt 05861500 17 c5 96 57 02 3c 67 61 6d 61 ff 71 4d 86 fc e4 |...W.\u0026lt;gama.qM...| 但需要文件的时长够长。比如只有几秒的，就只有一个正常的 gama atom。会不会出现两个 gama atom 的 pattern，取决于这个 prores 文件的时长多长，我测试过 5 分钟没有，10 分钟开始有，20 分钟也有。\nFile name Numbers of gama Notes 1-1-1_10mins.mov one gama pattern It\u0026rsquo;s not supposed to have! 1-1-1_20mins.mov one gama pattern It\u0026rsquo;s not supposed to have! 1-2-1_10mins.mov two gama pattern Expected one, found two instead. 1-2-1_20mins.mov two gama pattern Expected one, found two instead. icpf frame:\nframe_size: u(32) frame_identifier: f(32) frame_header: frame_header_size: u(16) reserved bitstream_version: u(8) encoder_identifier: f(32) horizontal_size: u(16) vertical_size: u(16) chroma_format: u(2) reserved picture: \u0026hellip; 00000020 6d 64 61 74 00 01 51 80 00 09 68 00 69 63 70 66 |mdat..Q...h.icpf| 00000030 00 94 00 00 61 70 6c 30 07 80 04 38 80 00 01 02 |....apl0...8....| 00000040 01 30 00 03 04 04 05 05 06 07 07 09 04 04 05 06 |.0..............| The frame size of 4 bytes before the icpf is 00 09 68 00. The frame header size of 4 bytes after the icpf is 00 94 00 00. Following the frame header is the encoder_identifier, which here is 61 70 6c 30.\n(next) pos = previous (frame_size + pos)\ncurrent (pos + frame_size) = next (pos)\n修改 gama atom 值的功能实现了以后，我把一个 1-2-1 的 MOV 视频的 Gamma 值从 2.4 改成 1.96。然后将其与 1-1-1 的 MOV 视频对比（都是用 QuickTime 播放器打开），可以发现画面整个一模一样。\nAssimilate SCRATCH 的 Rec.709 Gamma 2.4 render 的行为是正常的，在 Output Settings \u0026gt; Data Format 中选择：\nColor: Rec709 EOTF: Gamma 2.4 这样渲染出来的 ProRes MOV 文件的 tagging 为 1-2-1 Gamma 2.4。\nSCRATCH 中，你也可以选择把文件特别的 tag 成 Gamma 2.2 或者 2.6 都可以，有 2.2 和 2.6 的选项。对于 atom-modifier（我的 CLI 工具）来说，你可以用它把你 1-2-1 文件的 Gamma 设置成任何值（讲道理除了 2.4、2.2、2.6 你也不需要其他值了），甚至负数（别）。\nAMCDXVideoPatcher 可以在原文件根本没有 gama atom 的情况下，添加一个 gama atom，然后设定相应的 Gamma 值（它的 GUI 好像有 bug，只能设定 1.8 的 Gamma 值，那个输入框无法输入其他值）。我对比了使用它添加 gama atom 之前和之后，文件的状态。发现：添加完 gama atom 之后，gama atom 之后的 atoms 的 offset 全部 shift 了 12 bytes。Maybe 确实像我前几天所说：\n难道要 shift 所有其他 bytes？\nclean aperture (clap) - QuickTime File Format\n之前听说的一个问题，ARRI 的一些分辨率在 SCRACH 和 DaVinci Resolve 的分辨率显示不一样。SCRACH 比如说可能显示的是 2944x2160，DaVinci Resolve 显示的 as expected 为 2880x2160。症结在此：clean aperture (clap) — 一个 video sample description (\u0026ldquo;stsd\u0026rdquo;) 的 extension。colr 和 gama atom 都属于这个 \u0026ldquo;stsd\u0026rdquo;。\ncolr atom, gama atom are located in\u0026hellip;here!\nSample table atom (\u0026ldquo;stbl\u0026rdquo;): The sample table atom contains all the time and data indexing of the media samples in a track. Using tables, it is possible to locate samples in time, determine their type, and determine their size, container, and offset into that container.\n\u0026ldquo;stbl\u0026rdquo; 本身有两个属性：\nSize: 4 bytes Type: \u0026ldquo;stbl\u0026rdquo;, 4 bytes 剩下就是很多其它的 child atoms 了，相当于都在 \u0026ldquo;stbl\u0026rdquo; 之下。其中就有 \u0026ldquo;stsd\u0026rdquo;:\n\u0026ldquo;stbl\u0026rdquo;:\n\u0026ldquo;stsd\u0026rdquo;: Sample description atom \u0026ldquo;stts\u0026rdquo;: Time-to-sample atom \u0026ldquo;ctts\u0026rdquo;: Composition offset atom \u0026ldquo;cslg\u0026rdquo;: Composition shift least greatest atom \u0026ldquo;stss\u0026rdquo;: Sync sample atom \u0026ldquo;stps\u0026rdquo;: Partial sync sample atom \u0026ldquo;stsc\u0026rdquo;: Sample-to-chunk atom \u0026ldquo;stsz\u0026rdquo;: Sample size atom \u0026ldquo;stco\u0026rdquo;: Chunk offset atom \u0026ldquo;sdtp\u0026rdquo;: Sample dependency flags atom \u0026ldquo;stsh\u0026rdquo;: Shadow sync atom Sample description atom (\u0026ldquo;stsd\u0026rdquo;): \u0026ldquo;stsd\u0026rdquo; layout:\nSize: 4 bytes Type: \u0026ldquo;stsd\u0026rdquo;, 4 bytes Version: 1 bytes Flags: 3 bytes Number of entries: 4 bytes Sample description table: variable Sample description table 一般来说又由以下几个部分组成:\nGeneral structure of sample description:\n\u0026hellip; (continued from above bullets) Sample description size Data format Reserved Data reference index 但更常见的是除了这四个 field 之外还有其他 specific to the media type 的 field。比如有我们关心的 Video sample description (\u0026ldquo;stsd\u0026rdquo;)，它有一些 additional 的 fields。\n\u0026hellip; (continued from above bullets) Version Revision level Vendor Temporal quality Spatial quality Width Height Horizontal resolution Vertical resolution Data size Frame count Compressor name Depth Color table ID 除此之外，还有一个叫做 Video sample description extension 的东西，如果它存在 present，那么上面的 bullet points 又会增加几个。这时 colr atom, gama atom 出现了：\n\u0026hellip; (continued from above bullets) avcC colr gama pasp clap \u0026hellip; 你会发现，这些其实是一些 atom（相当于 stbl 的 child atom? I guess.），而上面那些是一些类似 fields 的东西。没错，它们都在 Sample description tale 之下。这就是 colr atom, gama atom 的 location。\n卷名 Reel number/name is located at: (Source reference!)\nstbl\nstsd tmcd Timecode sample description\n\u0026hellip; Source reference: A user data atom containing information about the source tape. 时码相关的信息也在这个 atom — \u0026ldquo;tmcd\u0026rdquo;。\nHow to create/insert a new atom? This article explains how to create and insert a new atom using the CoreMedia library in Swift:\nCreate new atoms and insert them in a QT atom container. — Apple Developer Documentation\n\u0026ldquo;mdat\u0026rdquo;:\n我们经常会发现一到 mdat 这个 atom，parser 就会跳过这么多 byte。\nmdat: s= 263696 (0x00040610), o= 28 (0x0000001c) ...skipped 263688 bytes moov: s= 1544 (0x00000608), o= 263724 (0x0004062c) The most important part of an MPEG-4 file is the mdat atom - its where the actual raw information for the file is stored. — atomic parsley\n这是实际上文件的 raw data 的所在地。\nProRes 每一帧 的 frame size 都可以在 \u0026ldquo;stsz\u0026rdquo; 找到。\nMovie atom:\nOnly metadata is stored in a movie atom.\n一个 MOV file 的所谓 metadata，全都储存在 movie atom (\u0026ldquo;moov\u0026rdquo;) 里。\nSample data for the movie, such as audio or video samples, are referenced in the movie atom, but are not contained in it. — QuickTime File Format \u0026gt; Movie Atoms - Apple Developer Documentation\nQuickTime File Format 把 media file 实际的数据储存在一个个 Sample 里，Sample 进而又组成一个个 Chunk，实现更高效的数据 access。Sample 的 data 不实际储存在 movie atom 里，像上面说的，movie atom 只储存 metadata。\nUser data atoms — \u0026ldquo;udta\u0026rdquo;:\n可以把生成这个 mov file 的软件的名字包含进去，\nList entry type Description \u0026hellip; \u0026hellip; '©swr' Name and version number of the software (or hardware) that generated this movie \u0026hellip; \u0026hellip; 比如：\n| | | [3]{}: box 0x11a37b70| 00 00 00| ...| size: 60 0x11a37b80|3c |\u0026lt; | 0x11a37b80| 75 64 74 61 | udta | type: \u0026#34;udta\u0026#34; (User-data) | | | boxes[0:1]: | | | [0]{}: box 0x11a37b80| 00 00 00 34 | ...4 | size: 52 0x11a37b80| a9 73 77 72 | .swr | type: \u0026#34;©swr\u0026#34; (Encoder) 0x11a37b80| 00 28 | .( | length: 40 0x11a37b80| 55| U| language: \u0026#34;und\u0026#34; 0x11a37b90|c4 |. | 0x11a37b90| 42 6c 61 63 6b 6d 61 67 69 63 20 44 65 73 69| Blackmagic Desi| value: \u0026#34;Blackmagic Design DaVinci Resolve Studio\u0026#34; 0x11a37ba0|67 6e 20 44 61 56 69 6e 63 69 20 52 65 73 6f 6c|gn DaVinci Resol| 0x11a37bb0|76 65 20 53 74 75 64 69 6f |ve Studio | Because the first field in any atom contains its size, including any contained atoms, it is easy to skip to the end of an unknown atom type and continue parsing the file. — QuickTime File Format \u0026gt; QuickTime Movie File — Apple Developer Documentation\nalfg/mp4-rust: MP4 reader + writer library in Rust!\n这个项目值得贡献一下。目前的状态还是比较初级，有很多 atom/box 都没支持。\n说到底 fq 这个用 Go 写的 parser 才是牛啊。mp4-rust 不支持的 atom/box 我都是通过 fq parsing 出来发现的。目前我所知的 atom/box，fq 都是支持的。那么可以给 mp4-rust 贡献一下的点在于，给它添加我最需要的 colr atom 和 gama atom 的支持。这也是我最开始关注这个项目的原因。但现在发现还需要给它添加 parse ProRes 编码家族的支持，就像 Ian Jun 给它添加 avc1 编码支持一样（添加一个 avc1 box）。avc1 是 H.264 的 Codec ID，它之下有一个 avcc configuration atom/box。\n说到 parser ISOBMFF，项目其实蛮多的。MediaInfo 也是其中之一，也是 canonical 的 implementation，是类似工具在实现效果上的参考，fq 也一样（这样来看 fq 这个工具写挺好的）。\n这个 pull request（目前还未被合并）给 Bento4 添加了 colr, gama, pasp, fiel atom 的支持。然后利用 Bento4 现有的工具，特别是这个 mp4edit 已经可以完全实现修改 colr atom 和添加 gama atom 了。到此为止，我最初的需求被这个工具解决了。\n插入 gama atom：\n./mp4edit \\ --insert \\ \u0026#34;moov/trak/mdia/minf/stbl/stsd/apcn\u0026#34;:gama_atom_2.4.bin \\ input.mov \\ output.mov 修改 colr atom：\necho -n -e \u0026#39;\\x00\\x00\\x00\\x12colrnclc\\x00\\x09\\x00\\x10\\x00\\x09\\x0a\u0026#39; \u0026gt; colr.bin ./mp4edit \\ --replace \\ \u0026#34;moov/trak/mdia/minf/stbl/stsd/apcn/colr\u0026#34;:colr.bin \\ input.mov \\ output.mov tmcd atom 包含卷名信息，给没有卷名的 MOV 添加卷名，使用：\n./mp4edit \\ --replace \\ \u0026#34;moov/trak[1]/mdia/minf/stbl/stsd/tmcd\u0026#34;:../atoms/tmcd_atom_addedReelNum.bin \\ ../test_footages/no_reel_number/1-1-1_10frames.mov \\ ../test_footages/no_reel_number/1-1-1_10frames_replacedTmcdAtom.mov 原理是替换掉 tmcd 这个 atom：使用带有卷名信息的 tmcd atom .bin 文件替换掉原始文件中的 tmcd atom。\n目前卷名还是 hardcoded 在那个 bin 文件里，需要通过 programming 的方式实时生成相应的不同卷名的 .bin file。\n所以到目前为止只是验证了使用 mp4edit 来修改、添加卷名的可行性。\nCan I compile Rust code together with a binary C++ file?\nCall mp4edit executable in Rust code. Build a GUI using egui library. ","permalink":"https://thomjiji.github.io/posts/2023/09/parse-quicktime/","summary":"Apple Developer Documentation Storing and sharing media with QuickTime files Color parameter atom (\u0026lsquo;colr\u0026rsquo;) Uncompressed Y´CbCr Video in QuickTime Files — Documentation Archive Other resources Apple ProRes - MultiMedia Wiki QuickTime Tags - ExifTool MPEG-4 files - Atomic Parsley MP4RA - Official Registration Authority for the ISOBMFF family of standards Implementations/tools Implementations Language Notes metacolor.editor C# Simple Implementation, can only change NCLC tags. Provide GUI. qtff-parameter-editor C++ Good implementation, can only change NCLC tags.","title":"Parse QuickTime"},{"content":"Reference Machine Learning Glossary - Google for Developers\nactivation function A function that enables neural networks to learn non-linear (complex) relationships between features and the label. Popupar activation functions include:\nReLU Sigmoid Tanh backpropagation The algorithm that implements gradient descent in neural networks.\nTraining a neural network involves many iterations of the following two-pass cycle:\nDuring the forward pass, the system processes a batch of examples to yild prediction(s). The system compares each prediction to each label value. The difference between the prediction and the lable value is the loss for that example. The system aggregates the losses for all the examples to compute the total loss for the current batch. During the backward pass (backpropagation), the system reduces loss by adjusting the weights of all the neurons in all the hidden layer(s). Neural networks often contain many neurons across many hidden layers. Each of those neurons contribute to the overall loss in difference ways. Backpropagation determines whether to increase or decrease the weights applied to particular neurons.\nThe learning rate is a multiplier that controls the degree the which each backward pass increase or decreases each weight. A larget learning rate will increase or decrease each weight more than a small learning rate.\nIn calculus terms, backpropagation inplements calculus\u0026rsquo; chain rule. That is, backpropagation calculuates the partial derivative of the error with respect to each parameter.\nmodel In general, any mathematical construct that processes input and returns output. Phrased differently, a model is the set of parameters and structure needed for a system to make predictions. In supervised machine learning, a model takes an example as input and infers a prediction as output. Within supervised machine learning, models differ somewhat. For example:\nA linear regression model consists of a set of weights and a bias. A neural network model consists of: A set of hidden layers, each containing one or more neurons. The weights and bias associated with each neuron. A decision tree model consists of: The shape of the tree; that is, the pattern in which the conditions and leaves are connected. The conditions and leaves. You can save, restore, or make copies of a model.\nUnsupervised machine learning also generates models, typically a function that can map an input example to the most appropriate cluster.\nembeddings An embedding is a relatively low-dimensional space into which you can translate high-dimensional vectors. Embeddings make it easier to do machine learning on large inputs like sparse vectors representing words. Ideally, an embedding captures some of the semantics of the input by placing semantically similar inputs close together in the embedding space. An embedding can be learned and reused across models.\nAutomatic Differentiation All modern deep learning frameworks take the differentiation work off of our plates by offering automatic differentiation (often shortened to autograd). As we pass data through each successive function, the framework build a computational graph that tracks how each value depends on others. To calculate derivatives, automatic differentiation works backwards through this graph applying the chain rule. The computational algorithm for applying the chain rule in this fashion is called backpropagation.\n","permalink":"https://thomjiji.github.io/posts/2023/09/machine-learning-glossary/","summary":"Reference Machine Learning Glossary - Google for Developers\nactivation function A function that enables neural networks to learn non-linear (complex) relationships between features and the label. Popupar activation functions include:\nReLU Sigmoid Tanh backpropagation The algorithm that implements gradient descent in neural networks.\nTraining a neural network involves many iterations of the following two-pass cycle:\nDuring the forward pass, the system processes a batch of examples to yild prediction(s). The system compares each prediction to each label value.","title":"Machine Learning Glossary"},{"content":"Intermediate Value Theorem (IVT) If a function $f(x)$ is continuous on a closed interval $[a, b]$ and $k$ is any number between $f(a)$ and $f(b)$, then there is at least one number $c$ in the interval $[a, b]$ such that $f( c) = k$.\nThe intermediate value theorem has two conditions:\nFunction $f$ is continuous over the interval $[a, b]$. The value $d$ lies between $f(a)$ and $f(b)$ We must establish these two conditions to conclude that there is a value $c$ in the interval $[a, b]$ for which $g(x) = d$ (another way to phrase this conclusion is that the equation $g(x) = d$ has a solution where $a \u0026lt;= x \u0026lt;= b$).\nProperty of limits of composite functions If $u$ are functions such that $\\displaystyle\\lim_{x \\to c} u(x) = L$ and $\\displaystyle\\lim_{x \\to L} u(x) = u(L)$ (which means both limits exist and $u$ is continuous at $x = L$), then\n$$\\displaystyle\\lim_{x \\to c} u(u(x)) = u(\\lim_{x \\to c} u(x)) = u(L)$$\nDealing with composite function\u0026rsquo;s limits When dealing with composite exponential functions, we can let $y$ equals to that function, then take natural log on both sides:\nSteps Process 1 $y = (2x - 1)^\\frac{1}{x - 1}$ 2 $\\ln(y) = \\ln((2x - 1)^\\frac{1}{x - 1}) = \\frac{1}{x - 1} \\cdot \\ln(2x-1) = \\frac{\\ln(2x-1)}{x - 1}$ By doing this, we can bring the complex exponent in front.\nSqueeze Theorem The squeeze theorem tells us that if we have three function $f$, $g$, and $h$ such that\u0026hellip;\n$g(x) \u0026lt;= f(x) \u0026lt;= h(x)$ for all $x$-values other than $x = c$ in an interval round $x = c$, and $\\displaystyle\\lim_{x \\to c} g(x) = \\lim_{x \\to c} h(x) = L$ Then we can conclude that $\\displaystyle\\lim_{x \\to c} f(x) = L$.\nDerivative of Function The derivative of function $f$ at the point where $x = a$ is defined by:\n$$f\\prime(a) = \\lim_{{h \\to 0}} \\frac{{f(a + h) - f(a)}}{h}$$\nThe alternative form is:\n$$f\\prime(a) = \\lim_{{x \\to a}} \\frac{{f(x) - f(a)}}{x - a}$$\nThe whole underlying idea of the formal definition of limits is to find the slope of the secant line between these two points, and then take the limit as $h$ approaches $0$. And the secant line is going to become a better and better approximation of the tangent line at $x$.\nUnder what conditions can a function be considered continuous? A function $f(x)$ is considered continuous at a point $x = a$ if the following conditions are all met:\nDefined: The function $f(x)$ is defined at $x = a$. Meaning you can substitute a into the function and get a real number.\nLimit Exists: The limit of the function as $x$ approaches $a$ exists. This means that as $x$ gets closer and closer to a from either direction, $f(x)$ approaches some specific value $L$.\nFunction Equals Limit: The value of the function at $a$ is equal to the limit of the function as $x$ approaches $a$. In other words, $f(a) = L$.\nThe function $f(x)$ is said to be continuous on an interval if it is continuous at every point in that interval. It is said to be continuous everywhere or simply continuous if it is continuous at every point over its entire domain.\nSo, Mathematically, A function $f(x)$ is continuous at $x = a$ if $\\lim_{{x \\to a}} f(x) = f(a)$\nOr more explicitly, it is continuous at $x = a$ if $\\lim_{{x \\to a^-}} f(x) = f(a) = \\lim_{{x \\to a^+}} f(x)$\nWhere $\\lim_{{x \\to a^-}} f(x)$ is the limit as $x$ approaches $a$ from the left, $f(a)$ is the function value at $a$, and $\\lim_{{x \\to a^+}} f(x)$ is the limit as $x$ approaches $a$ from the right.\nIf all three of these quantities are the same, then $f(x)$ is continuous at $x = a$.\nDifferentiability Implies Continuity There are three cases where a function is not differentiable:\nWherever the function isn\u0026rsquo;t continuous Wherever the graph of the function has a vertical tangent line Wherever the graph of the function has a sharp turn In order to be differentiable, you need to be continuous. You can\u0026rsquo;t have differentiable but not continuous. In order to be continuous, $\\displaystyle f(a) = \\lim_{{x \\to a}} f(x)$. Two one-sided limits exist, and are equal to $f(a)$. In order to be differentiable, $\\displaystyle \\lim_{{x \\to a}} \\frac{{f(x) - f(a)}}{x - a}$ needs to exist. If a function is differentiable then it\u0026rsquo;s also continuous. This property is very useful when working with functions, because if we know that a function is differentiable, we immediately know that it\u0026rsquo;s also continuous.\nDifferentiation Rules Rules Expression Constant rule $\\frac{d}{dx}(k) = 0$ Constant multiple rule $\\frac{d}{dx}[k \\cdot f(x)] = k \\cdot f\\prime(x)$ Sum rule $\\frac{d}{dx}[f(x) + g(x)] = f\\prime(x) + g\\prime(x)$ Difference rule $\\frac{d}{dx}[f(x) - g(x)] = f\\prime(x) - g\\prime(x)$ Power Rule $\\frac{d}{dx} (x^n) = n x^{n-1}$ Product Rule $\\frac{d}{dx} [f(x) \\cdot g(x)] = \\frac{d}{dx}[f(x)] \\cdot g(x) + f(x) \\cdot \\frac{d}{dx}[g(x)]$ Quotient Rule $\\frac{d}{dx} \\left[\\frac{f(x)}{g(x)}\\right] = \\frac{\\frac{d}{dx} [f(x)] \\cdot g(x) -f(x) \\cdot \\frac{d}{dx}[g(x)]} {[g(x)]^2}$ Chain Rule If $g$ is differentiable at $x$ and $f$ is differentiable at $g(x)$, then the composite function $F = f \\circ g$ defined by $F(x) = f(g(x))$ is differentiable at $x$ and $F\\prime$ is given by the product\n$$ F\\prime[f(g(x))] = f\\prime(g(x)) \\cdot g\\prime(x) $$\nif $y = f(u)$ and $u = g(x)$ are both differentiable functions, then\n$$ \\frac{dy}{dx} = \\frac{dv}{du} \\cdot \\frac{du}{dx} $$\nDerivatives of the Trigonometric Functions Trigonometric Derivative sin $\\frac{d}{dx} [\\sin (x)] = \\cos(x)$ cos $\\frac{d}{dx} [\\cos (x)] = -\\sin(x)$ tan $\\frac{d}{dx} [\\tan (x)] = \\frac{d}{dx} \\left [\\frac{\\sin(x)}{\\cos(x)} \\right] = \\frac{1}{\\cos^2(x)} = \\sec^2(x)$ cot $\\frac{d}{dx} [\\cot (x)] = \\frac{d}{dx} \\left[\\frac{\\cos(x)}{\\sin(x)}\\right] = -\\frac{1} {\\sin^2(x)} = -\\csc^2(x)$ csc $\\frac{d}{dx} [\\csc (x)] = -\\frac{\\cos(x)}{\\sin^2(x)} = -\\csc(x) \\cdot \\cot(x)$ sec $\\frac{d}{dx} [\\sec (x)] = \\frac{\\sin(x)}{\\cos^2(x)} = \\sec(x) \\cdot \\tan(x)$ Two Special Trigonometric Limits $\\lim_{\\theta \\to 0} \\frac{\\sin \\theta}{\\theta} = 1$ $\\lim_{\\theta \\to 0} \\frac{\\cos \\theta - 1}{\\theta} = 0$ Derivative of $e$ $$ \\frac{d}{dx} e^x = e^x $$\nDerivative of $\\ln(x)$ $$ \\frac{d}{dx} [\\ln(x)] = \\frac{1}{x} $$\nComposite and combined functions A composite function is where we make the output from one function, such as $u$, the input for another function, such as $w$.\nWe can also combine functions using arithmetic operations, but such a combination is not considered a composite function.\nOur two functions appear to be $x-8$ and $e^x$, but neither of them takes the other as its input.\nDerivatives of Exponential Functions If $b$ is a constant, then\n$$ \\frac{d}{dx} (b^x) = \\ln(b) \\cdot b^x $$\nDerivatives of Logarithmic Functions If $a$ is a constant, $a \\neq 1$, then\n$$ \\frac{d}{dx} \\left[\\log_a(x)\\right] = \\frac{1}{\\ln(a) \\cdot x} $$\n$$ \\frac{d}{dx} \\left[\\ln(u(x)) \\right] = \\frac{u\\prime(x)}{u(x)} $$\nDerivative of Inverse Function Let\u0026rsquo;s say $f(x)$ and $g(x)$ are inverse function (and both are differentiable), so by definition, we have this equation:\n$$ f(g(x)) = x $$\nWe take derivative of both sides:\n$$ \\frac{d}{dx} f(g(x)) = \\frac{d}{dx} (x)$$\nUse chain rule to the left-hand side, right-hand side equals to 1. Finally, we get:\n$$ f\\prime(x) = \\frac{1}{g\\prime(f(x))} $$\nDerivative of Inverse Sine, Cosine, Tangent $$\\frac{d}{dx} \\left[\\sin^{-1}(x)\\right] = \\frac{1}{\\sqrt{1 - x^2}} $$\n$$\\frac{d}{dx} \\left[\\cos^{-1}(x)\\right] = -\\frac{1}{\\sqrt{1 - x^2}} $$\n$$\\frac{d}{dx} \\left[\\tan^{-1}(x)\\right] = \\frac{1}{1 + x^2} $$\nInterpret motion graph The direction of movement is indicated by the velocity\u0026rsquo;s sign:\nIf the velocity is positive, the object is moving forward. If the velocity is negative, the object is moving backward. If the velocity is zero, the object is not moving. The direction of the position graph indicates the direction of movement:\nIf the graph is increasing, the object is moving forward. If the graph is decreasing, the object is moving backward. If the graph is nether increasing not decreasing, the object is not moving. This happens at extremum points of the graph. Speed is the magnitude of velocity. When analyzing linear motion,\n$$ \\text{speed} = | \\text{velocity} | $$\nSo the object is speeding up whenever the absolute value of the velocity is increasing, and slowing down whenever the absolute value of the velocity is decreasing.\nWhen the velocity is zero, the object isn\u0026rsquo;t speeding up or slowing down.\nVelocity as a function of time is the derivative of position:\n$$ v(t) = x\\prime(t) $$\nAcceleration as a function of time is the derivative of velocity, which is the second derivative of position:\n$$ a(t) = v\\prime(t) = x\\prime\\prime(t) $$\nVelocity and Acceleration Velocity: The rate of change of displacement (位移) with respect to time. Acceleration: The instantaneous rate of change of velocity with respect to time. Velocity Acceleration Speed Positive Positive Increasing Negative Negative Increasing Positive Negative Decreasing Negative Positive Decreasing If the acceleration is positive, and velocity is positive, that means the magnitude of velocity is increasing, so that means the speed is increasing.\nIf the acceleration is negative, and the velocity is also negative, that also means the speed is increasing.\nBut the velocity and acceleration have different signs, that mean the speed is decreasing.\nRelated rates This is the core of our solution: by relating the quantities (i.e., $A$ and $r$) we were able to relate their rates (i.e., $A\\prime$ and $r\\prime$) through differentiation. This is why these problems are called \u0026ldquo;related rates\u0026rdquo;.\nFor example, what we know is $\\frac{dy}{dt}$ ($y\\prime(t)$), what we are seeking for is $\\frac{dx}{dt}$ ($x\\prime(t)$). So, if we can find the relationship between $y$ and $x$, then take derivative on them, we can find derivative of $x$ by solve for $\\frac{dx}{dt}$.\nLinear approximation But what they\u0026rsquo;re suggesting that we do is use this tangent line. If we know the equation of this tangent line here, we can say what the tangent line equals when x equals 1.9? When x equals 1.9, it equals that point over there. And then we could use that as our approximation.\nThe tangent line gives us a \u0026ldquo;best\u0026rdquo; linear approximation to the function $h$ near the point $x = 0$ (or $x = a$). If we were to graph the function $h$ and the line $y= 4x - 5$ together, the two would be very close together near $x = 0$ (or $x = a$), although they may diverge as we move away or zoom out from this point.\nL\u0026rsquo;Hôpital\u0026rsquo;s rule L\u0026rsquo;Hôpital\u0026rsquo;s rule states that for functions $f$ and $g$ which are differentiable on an open interval $I$ except possibly at a point $c$ contained in $I$, if $\\lim_{x \\to c} f(x) = \\lim_{x \\to c} g(x) = 0$ or $±\\infty$, and $g\\prime(x) \\neq 0$ for all $x$ in $I$ with $x \\neq c$, and $\\lim_{x \\to c} \\frac{f\\prime(x)}{g\\prime(x)}$ exists, then\n$$ \\displaystyle \\lim _{x\\to c}{\\frac {f(x)}{g(x)}}=\\lim _{x\\to c}{\\frac {f\\prime(x)} {g\\prime(x)}} $$\nThe differentiation of the numerator and denominator often simplifies the quotient or converts it to a limit that can be evaluated directly.\nMean value theorem (MVT) The mean value theorem connects the average rate of change of a function to its derivative. It says that for any differentiable function $f$ and an interval $[a, b]$ (within the domain of $f$), there exists a number $c$ within $(a, b)$ such that $f\\prime(c)$ is equal to the function\u0026rsquo;s average rate of change over $[a, b]$.\nGraphically, the theorem says that for any arc (弧线) between two endpoints, there\u0026rsquo;s a point at which the tangent the arc is parallel to the secant through its endpoints.\nFormal definition\nLet $f$ be a function that satisfies the following hypotheses:\n$f$ is continuous on the closed interval $[a, b]$. $f$ is differentiable on the open interval $(a, b)$. Then there is a number $c$ in $(a, b)$ such that\n$$ f\\prime(c) = \\frac{f(b) - f(a)}{b - a} $$\nOr, equivalently,\n$$ f(b) - f(a) = f\\prime(c)(b - a) $$\nThe mean value theorem has two conditions:\nFunction $g$ is differentiable over the open interval $(a, b)$ and continuous over the closed interval $[a, b]$. The average rate of change is equal to the slope of that point on the function. $f\\prime( c) = \\frac{f(b) - f(a)}{b - a}$ Critical number A critical number of a function $f$ is a number $c$ in the domain of $f$ such that either $f\\prime(c) = 0$ or $f\\prime(c)$ does not exist.\nIntervals on which a function is increasing or decreasing $f\\prime$\u0026rsquo;s status which means $f$ $f\\prime \u0026gt; 0$ ($f\\prime$ is positive) \u0026lt;=\u0026gt; $f$ is increasing $f\\prime \u0026lt; 0$ ($f\\prime$ is negative) \u0026lt;=\u0026gt; $f$ is decreasing The intervals where the derivative $f\\prime$ is positive (i.e., above the $x$-axis) are the intervals where the function $f$ is increasing. The intervals where the derivative $f\\prime$ is negative (i.e., below the $x$-axis) are the intervals where the function $f$ is decreasing. A function can only change its direction from increasing to decreasing and vice versa between its critical points and the points where the function itself is undefined.\nRelative extrema Local minimum is the point where $f\\prime = 0$ and $f\\prime\\prime \u0026gt; 0$ (means $f\\prime$ is increasing). Local maximum is the point where $f\\prime = 0$ and $f\\prime\\prime \u0026lt; 0$ (means $f\\prime$ is decreasing). We must not assume that any critical point is an extremum. Instead, we should check out critical points to see if the function is defined at those points and the derivative changes signs at those points. When we analyze increasing and decreasing intervals, we must look for all points where the derivative is equal to zero and all points where the function or its derivative is undefined. If you miss any of these points, you will probably end up with a wrong sign chart. Second Derivative Test Suppose $f(x)$ is a function of $x$ that is twice differentiable at a stationary point (minimum point, maximum point and inflection point) $x_0$, $f\\prime(x_0) = 0$, then:\nIf $f\\prime\\prime(x_0) \u0026gt; 0$ then $f$ has a local minimum at $x_0$. If $f\\prime\\prime(x_0) \u0026lt; 0$ then $f$ has a local maximum at $x_0$. Absolute extrema An absolute maximum point is a point where the function obtains its greatest possible value. Similarly, an absolute minimum point is a point where the function obtains its least possible value.\nThese extreme values are obtained, either on a relative extremum point within the interval, or on the endpoints of the interval.\nExtreme value theorem If a function is continuous on a closed interval $[a,b]$, then the function must have a maximum and a minimum on the interval.\nFormal definition\nIf $f$ is continuous on a closed interval $[a, b]$, then $f$ attains an absolute maximum value $f(c)$ and an absolute minimum value $f(d)$ at some numbers $c$ and $d$ in $[a, b]$.\nConcavity Concave up if the $f\\prime$ increases, concave down if $f\\prime$ decreases.\nConcave up equivalent to $g\\prime(x)$ is increasing =\u0026gt; $g\\prime\\prime(x) \u0026gt; 0$ Concave down equivalent to $g\\prime(x)$ is decreasing =\u0026gt; $g\\prime\\prime(x) \u0026lt; 0$ Inflection point (拐点) Inflection points are points where the function changes concavity, i.e., from being \u0026ldquo;concave up\u0026rdquo; (the slope of the function - $f\\prime$ is increasing) to \u0026ldquo;concave down\u0026rdquo; (the slope of the function - $f\\prime$ is decreasing) or vice versa. They can be found by considering where the second derivative changes signs.\nInflection points will occur when the second derivative is either zero or undefined. Even if critical points are found, they can only be considered as candidates before actually testing them.\nFinding inflection points is similar to finding extreme points. Instead of looking for points where the derivative changes its sign, we are looking for points where the second derivative changes its sign.\n$f\\prime$\u0026rsquo;s (relative) minimum or maximum point is possibly inflection point.\n","permalink":"https://thomjiji.github.io/posts/2023/08/calculus-recap/","summary":"Intermediate Value Theorem (IVT) If a function $f(x)$ is continuous on a closed interval $[a, b]$ and $k$ is any number between $f(a)$ and $f(b)$, then there is at least one number $c$ in the interval $[a, b]$ such that $f( c) = k$.\nThe intermediate value theorem has two conditions:\nFunction $f$ is continuous over the interval $[a, b]$. The value $d$ lies between $f(a)$ and $f(b)$ We must establish these two conditions to conclude that there is a value $c$ in the interval $[a, b]$ for which $g(x) = d$ (another way to phrase this conclusion is that the equation $g(x) = d$ has a solution where $a \u0026lt;= x \u0026lt;= b$).","title":"Calculus Recap"},{"content":"为什么从 Vim 切换回普通 Cursor Obsidian 用的就不是 Vim 模式。因为我需要在 Obsidian 输入中文，中文输入之下，Vim 完全是不可用的状态。我也不想去折腾怎么让 Vim 的模态切换在中文输入下也可用（应该是有这样的解决方案的）。\n其他地方，各种输入框：浏览器、Raycast、ChatGPT，包括网页的全局搜索框（Cmd+F），都不是工作在 Vim 的模式下（确实曾经也尝试过把浏览器也用 Vim keybind 来操作\u0026hellip;）。而在这些场景下使用普通的 Cursor 移动方式对我来说也已经非常熟练和习惯了。也觉得 Cmd ← 和 Cmd → 回到行首行尾和 Opt ←, Opt → （上一个词/下一个词）蛮好用的。\n我对在 Insert mode 和 Normal mode 之间切换感到疲倦。使用 Normal cursor 的话，就一个模式我想什么时候移动就什么时候移动。用 Vim 我还需要从 Insert mode 切换出来。而且我使用的退出 Insert mode 的 keybind 是 jk，而不是 Esc。之前觉得 Esc 在键盘的位置，还是会让手的 movement 太大。jk 直接就在 hjkl 下，手臂不需要移动，非常方便。但现在觉得 jk 都麻烦，尤其在模态之间切换频繁的话，一会儿就得 jk 来一下，非常繁琐——繁琐是因为模态的切换，而不是换个 keybind 就能解决的。所以我选择不要这些模态。\n在 PyCharm 的 Completion 之间选择 Candidates，有时需要上下移动选择那个我想要的。之前想把它们 bind 到 hjkl 上，但怎么都找不到办法，只有使用上下键。在 Vim 原教旨主义者看来很不 ok 是吧，但我当时忍了下来。现在想既然如此，为啥不直接全换到 Normal keybind。我知道是可以直接用 Emacs 的 keybind Ctrl n 和 Ctrl p 来上下选择，但。\n","permalink":"https://thomjiji.github.io/posts/2023/07/give-up-vim/","summary":"为什么从 Vim 切换回普通 Cursor Obsidian 用的就不是 Vim 模式。因为我需要在 Obsidian 输入中文，中文输入之下，Vim 完全是不可用的状态。我也不想去折腾怎么让 Vim 的模态切换在中文输入下也可用（应该是有这样的解决方案的）。\n其他地方，各种输入框：浏览器、Raycast、ChatGPT，包括网页的全局搜索框（Cmd+F），都不是工作在 Vim 的模式下（确实曾经也尝试过把浏览器也用 Vim keybind 来操作\u0026hellip;）。而在这些场景下使用普通的 Cursor 移动方式对我来说也已经非常熟练和习惯了。也觉得 Cmd ← 和 Cmd → 回到行首行尾和 Opt ←, Opt → （上一个词/下一个词）蛮好用的。\n我对在 Insert mode 和 Normal mode 之间切换感到疲倦。使用 Normal cursor 的话，就一个模式我想什么时候移动就什么时候移动。用 Vim 我还需要从 Insert mode 切换出来。而且我使用的退出 Insert mode 的 keybind 是 jk，而不是 Esc。之前觉得 Esc 在键盘的位置，还是会让手的 movement 太大。jk 直接就在 hjkl 下，手臂不需要移动，非常方便。但现在觉得 jk 都麻烦，尤其在模态之间切换频繁的话，一会儿就得 jk 来一下，非常繁琐——繁琐是因为模态的切换，而不是换个 keybind 就能解决的。所以我选择不要这些模态。\n在 PyCharm 的 Completion 之间选择 Candidates，有时需要上下移动选择那个我想要的。之前想把它们 bind 到 hjkl 上，但怎么都找不到办法，只有使用上下键。在 Vim 原教旨主义者看来很不 ok 是吧，但我当时忍了下来。现在想既然如此，为啥不直接全换到 Normal keybind。我知道是可以直接用 Emacs 的 keybind Ctrl n 和 Ctrl p 来上下选择，但。","title":"Give Up Vim"},{"content":"我主要用 DEVONthink 来管理我的 PDF 文档。那事情最初呢，是因为我想找一个 PDF 阅读器。首先考虑的自然是 PDF Expert，然后是 Adobe Acrobat Reader。PDF Expert 我以前在 Mac 上试用过，功能很简单，就是一个纯粹的 PDF 阅读器，可以标注划线啥的，能满足我基本需要。但它是订阅制，每年 79.9 刀，也不便宜。况且我也不太喜欢订阅制。想着数码荔枝有没有代理 PDF Expert 在国内的销售？这样兴许能便宜好多。但没有。Adobe Acrobat Reader 呢，下载玩了一下，印象不怎么好。再加上我对 Adobe 的软件都不怎么喜欢，印象都不怎么好（Creative Cloud 那一大坨东西啊……看着就头疼），这个 Acrobat 也赶紧卸载了。\n那么回过来一想，PDF 阅读器，macOS 自带的不能用吗？我也试了下，作为正经的主力的 PDF 阅读器，我还是别为难自己了。人那个系统自带的 Preview 啊，苹果一贯的所谓简洁设计，我要用的功能找半天也找不到（还是没有？不知道）。我还是放自己一马吧。\nDEVONthink，这个软件呢，以前就有所耳闻。估计还是 2016、2017 年那会儿，刚入坑这数码生活的时候就有听说，终极的知识管理工具。后来在环环的开箱 ARRI Mini LF 的直播录像中，有看到他也在用 DEVONthink，在开 Mini LF 的一些文档什么的。那时觉得哎他有一个地方可以放所有的 PDF 文档，想查哪个文档直接来这找就行。我当时还没有，文档都是不知道放在哪里，Google Drive 也好，MEGA Sync 也好，或者 iCloud 也有。而且，重点是 DEVONthink 它自带有 PDF 阅读器啊。这个就正合我意了，于是这才冒出念头我要实际下载来试一下。\nOk，下载安装了。这一大堆都是什么……噢看到有 Manual，还是一本…书？有提供 PDF 版本，EPUB 版本。这软件这么复杂的吗？当然我对这个复杂度也有预期，毕竟「终极知识管理工具」。那么先用起来吧。\n噢它是 Database 的概念。建一个 Database，所有的东西都存到这个 Database 里，存完后 Database 之外的副本就可以删掉了。然后 DEVONthink 软件在这个 Database 里做所有的扫描和索引，从而让你可以在里面全局搜索，不止搜文档名，搜索文档的内容都行。\n","permalink":"https://thomjiji.github.io/posts/2023/03/devonthink-unboxing/","summary":"我主要用 DEVONthink 来管理我的 PDF 文档。那事情最初呢，是因为我想找一个 PDF 阅读器。首先考虑的自然是 PDF Expert，然后是 Adobe Acrobat Reader。PDF Expert 我以前在 Mac 上试用过，功能很简单，就是一个纯粹的 PDF 阅读器，可以标注划线啥的，能满足我基本需要。但它是订阅制，每年 79.9 刀，也不便宜。况且我也不太喜欢订阅制。想着数码荔枝有没有代理 PDF Expert 在国内的销售？这样兴许能便宜好多。但没有。Adobe Acrobat Reader 呢，下载玩了一下，印象不怎么好。再加上我对 Adobe 的软件都不怎么喜欢，印象都不怎么好（Creative Cloud 那一大坨东西啊……看着就头疼），这个 Acrobat 也赶紧卸载了。\n那么回过来一想，PDF 阅读器，macOS 自带的不能用吗？我也试了下，作为正经的主力的 PDF 阅读器，我还是别为难自己了。人那个系统自带的 Preview 啊，苹果一贯的所谓简洁设计，我要用的功能找半天也找不到（还是没有？不知道）。我还是放自己一马吧。\nDEVONthink，这个软件呢，以前就有所耳闻。估计还是 2016、2017 年那会儿，刚入坑这数码生活的时候就有听说，终极的知识管理工具。后来在环环的开箱 ARRI Mini LF 的直播录像中，有看到他也在用 DEVONthink，在开 Mini LF 的一些文档什么的。那时觉得哎他有一个地方可以放所有的 PDF 文档，想查哪个文档直接来这找就行。我当时还没有，文档都是不知道放在哪里，Google Drive 也好，MEGA Sync 也好，或者 iCloud 也有。而且，重点是 DEVONthink 它自带有 PDF 阅读器啊。这个就正合我意了，于是这才冒出念头我要实际下载来试一下。\nOk，下载安装了。这一大堆都是什么……噢看到有 Manual，还是一本…书？有提供 PDF 版本，EPUB 版本。这软件这么复杂的吗？当然我对这个复杂度也有预期，毕竟「终极知识管理工具」。那么先用起来吧。\n噢它是 Database 的概念。建一个 Database，所有的东西都存到这个 Database 里，存完后 Database 之外的副本就可以删掉了。然后 DEVONthink 软件在这个 Database 里做所有的扫描和索引，从而让你可以在里面全局搜索，不止搜文档名，搜索文档的内容都行。","title":"DEVONthink 上手"},{"content":"对普通显示器校色的时候，很难不碰到 ICC profile 这个东西。我们都知道这个名词，显示器的 ICC 文件，或许模糊的对它有一些概念。但它究竟是什么？原理如何。\nICC profile 跟我们已经有很明确概念的 ACES，或者更广泛一些地讲：「现代的色彩管理流程」，是很相似的 idea。都有一个处于整个链路中间的非常大的色彩空间，大到足以容纳所有不同的输入、显示和输出设备的各种色域（sRGB、AdobeRGB、Rec.709 等等）1。这个色彩空间在 ICC 这个概念下叫作 PCS（Profile Connection Space）。ICC profile 通过定义设备源或目标色彩空间与 PCS 之间的映射来描述特定设备的色彩属性2。\nICC 本身并不进行任何校准，它们只包含显示器关于色彩成像能力的数据。这些数据用于帮助可以识别 ICC profile 的软件（我们叫它 ICC aware 的软件）通过 CMM（色彩管理模块）对图像进行调整，以尝试纠正显示器的色偏来进行校准。ICC profile 完成的实际上是对图像的调整，而不是对显示器的校正。不同的软件使用不同的 CMM 的话，即使都采用同一个 ICC，最终出来的结果也可能不一样。\nICC Profile - IBM\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nICC profile - Wikipedia\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://thomjiji.github.io/posts/2023/03/icc-profile/","summary":"对普通显示器校色的时候，很难不碰到 ICC profile 这个东西。我们都知道这个名词，显示器的 ICC 文件，或许模糊的对它有一些概念。但它究竟是什么？原理如何。\nICC profile 跟我们已经有很明确概念的 ACES，或者更广泛一些地讲：「现代的色彩管理流程」，是很相似的 idea。都有一个处于整个链路中间的非常大的色彩空间，大到足以容纳所有不同的输入、显示和输出设备的各种色域（sRGB、AdobeRGB、Rec.709 等等）1。这个色彩空间在 ICC 这个概念下叫作 PCS（Profile Connection Space）。ICC profile 通过定义设备源或目标色彩空间与 PCS 之间的映射来描述特定设备的色彩属性2。\nICC 本身并不进行任何校准，它们只包含显示器关于色彩成像能力的数据。这些数据用于帮助可以识别 ICC profile 的软件（我们叫它 ICC aware 的软件）通过 CMM（色彩管理模块）对图像进行调整，以尝试纠正显示器的色偏来进行校准。ICC profile 完成的实际上是对图像的调整，而不是对显示器的校正。不同的软件使用不同的 CMM 的话，即使都采用同一个 ICC，最终出来的结果也可能不一样。\nICC Profile - IBM\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nICC profile - Wikipedia\u0026#160;\u0026#x21a9;\u0026#xfe0e;","title":"ICC Profile"},{"content":"之前我们知道，DisplayCAL 这种校色软件的工作原理：它会生成一个配置文件，在系统里加载，实际作用到显卡的输出信号上。更细节一点则是：\nDisplayCAL 生成的 ICC 配置文件中会包含一个叫作 VCGT（Video Card Gamma Table）的 tag，它实际是一个 1D LUT，包含对显示器的灰阶或白点的校正。然后操作系统需要把这个 VCGT Tag 加载到显卡输出信号上的有一个 Look Up Table 上，从而实现对显卡输出信号的校正。同时显卡的这个 Look Up Table 也是有精度限制的。\n具体在使用 DisplayCAL 的时候，右键桌面右下角 DisplayCAL 的图标，就会看到有一个 Reset video card gamma table 的东西。在系统加载了 DisplayCAL 生成的 profile 的情况下，这时点一下 Reset video card gamma table 会发现整个桌面的反差，或者说 Gamma、灰阶变了，它把对于显卡的校正给重置掉了，回到了最初的状态。\n再者就是我们还可以在 DisplayCAL 的 Tone curve 的设置中看到：如果不把 Tone curve 设为 “As measured” 的话，比如手动设为 Gamma 2.2。那 DisplayCAL 会做这么一件事情：在校准过程中，会通过一个 1D LUT 来校准（中和、补偿）显示器本身与这条纯粹的、Gamma 为 2.2 的指数曲线不相符的地方。如果设为 “As measured” 的话，则显示器的 grey scale 是怎么样就是怎么样，不做任何的校准和调整。\n总的来说：\nVCGT Tag 是一个 1D LUT，包含灰阶和白点的校准信息。是使用 DisplayCAL 这种软件校准时，实际起校准作用的环节。相对可感的。 VCGT 并不包含在 ICC 的标准中，因此有的软件可能把 VCGT（1D LUT）包含在了 ICC 配置文件当中，DisplayCAL 就是如此。有的软件可能包含在别的地方。 ","permalink":"https://thomjiji.github.io/posts/2023/03/vcgt-tag/","summary":"之前我们知道，DisplayCAL 这种校色软件的工作原理：它会生成一个配置文件，在系统里加载，实际作用到显卡的输出信号上。更细节一点则是：\nDisplayCAL 生成的 ICC 配置文件中会包含一个叫作 VCGT（Video Card Gamma Table）的 tag，它实际是一个 1D LUT，包含对显示器的灰阶或白点的校正。然后操作系统需要把这个 VCGT Tag 加载到显卡输出信号上的有一个 Look Up Table 上，从而实现对显卡输出信号的校正。同时显卡的这个 Look Up Table 也是有精度限制的。\n具体在使用 DisplayCAL 的时候，右键桌面右下角 DisplayCAL 的图标，就会看到有一个 Reset video card gamma table 的东西。在系统加载了 DisplayCAL 生成的 profile 的情况下，这时点一下 Reset video card gamma table 会发现整个桌面的反差，或者说 Gamma、灰阶变了，它把对于显卡的校正给重置掉了，回到了最初的状态。\n再者就是我们还可以在 DisplayCAL 的 Tone curve 的设置中看到：如果不把 Tone curve 设为 “As measured” 的话，比如手动设为 Gamma 2.2。那 DisplayCAL 会做这么一件事情：在校准过程中，会通过一个 1D LUT 来校准（中和、补偿）显示器本身与这条纯粹的、Gamma 为 2.2 的指数曲线不相符的地方。如果设为 “As measured” 的话，则显示器的 grey scale 是怎么样就是怎么样，不做任何的校准和调整。","title":"VCGT Tag"},{"content":"做高端校色软件 ColourSpace 的 LightIllusion 有篇文章 What\u0026rsquo;s wrong with ICCs? 指出了 ICC profile 的一些问题。\n总的来说，ICC profile 能 work 的前提是软件本身支持它，软件是否是 ICC aware。通常来说 ICC aware 的软件有一个 CMM 色彩管理模块（Color Management Module）能够正确识别我们生成的 ICC profile，然后能够对图像做调整以达到「准确」的结果，实现校色的目的。先不说 ICC 这种方式本质上是对图像的调整，而不是对显示器本身的校正（后者是更好的方式，所谓硬件校准就是如此）。即使软件具有 CMM，准确度和性能还得看各个软件自身的优化。这就变成一件非常麻烦和复杂的事情。那些不是 ICC aware 的软件，看到的就做一个完全未经校准的画面。\n那对于 Adobe 全家桶来说，像 Ps、Lr 这种平面设计软件，它们是有 CMM 模块，叫作 ACE（Adobe Color Engine）。就是能够识别图像自带的 ICC profile，将其转换到 Ps 的工作色彩空间。那对于 Pr 来说，它也有被他们称为 DCM（Display Color Management）的东西，作为 Pr 内在的色彩管理方式，也是利用系统的 ICC profile 来进行工作的。\nDCM uses the ICC profile for your monitor to apply a colorimetric conversion from the sequence working color space (or media color space in the case of the source monitor) to the monitor color space. The profile is specified by the operating system. We generally recommended using the default profile that the system choses for your display. If your monitor has been professionally calibrated, use that profile. The default profile may have the name of your monitor or something generic like “Color LCD”. Using the specified display profile will ensure predictable colors across the system and in other apps like web browsers and email. DCM requires GPU Acceleration. GPU acceleration can be configured in Project Settings \u0026gt; General \u0026gt; Video Rendering and Playback. 1\nICC 主要还是平面设计领域的色彩管理方案，对于视频来说有很多局限性。虽然 ICC profile 是一种常见的色彩管理方式，但它并不是完美的，因为它只是对图像进行调整，而不是对显示器本身进行校正。使用上屏卡的一个最主要的原因就是绕过 ICC profile 乃至操作系统的整个色彩管理，更直接的获得一个干净的视频信号，而不去经过操作系统的色彩管理。而且对于监视器来说，一般需要是 SDI 接口，上屏卡也能满足这一点要求。\nNew HDR Workflow in Premiere Pro - 2020 User Guide (PDF)\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://thomjiji.github.io/posts/2023/03/why-do-we-need-video-card/","summary":"做高端校色软件 ColourSpace 的 LightIllusion 有篇文章 What\u0026rsquo;s wrong with ICCs? 指出了 ICC profile 的一些问题。\n总的来说，ICC profile 能 work 的前提是软件本身支持它，软件是否是 ICC aware。通常来说 ICC aware 的软件有一个 CMM 色彩管理模块（Color Management Module）能够正确识别我们生成的 ICC profile，然后能够对图像做调整以达到「准确」的结果，实现校色的目的。先不说 ICC 这种方式本质上是对图像的调整，而不是对显示器本身的校正（后者是更好的方式，所谓硬件校准就是如此）。即使软件具有 CMM，准确度和性能还得看各个软件自身的优化。这就变成一件非常麻烦和复杂的事情。那些不是 ICC aware 的软件，看到的就做一个完全未经校准的画面。\n那对于 Adobe 全家桶来说，像 Ps、Lr 这种平面设计软件，它们是有 CMM 模块，叫作 ACE（Adobe Color Engine）。就是能够识别图像自带的 ICC profile，将其转换到 Ps 的工作色彩空间。那对于 Pr 来说，它也有被他们称为 DCM（Display Color Management）的东西，作为 Pr 内在的色彩管理方式，也是利用系统的 ICC profile 来进行工作的。\nDCM uses the ICC profile for your monitor to apply a colorimetric conversion from the sequence working color space (or media color space in the case of the source monitor) to the monitor color space.","title":"为什么使用上屏卡"},{"content":"DisplayCAL 官网 User Guide 在对显示器校色之前，必须预热至少 30 分钟。这一点在我最近的校准过程中可以明确体会到，比如：在调整显示器自身的 RGB 输出时，当你把红绿蓝三个通道终于调到一条线上之后，这时亮度不达标了。调节显示器的亮度以达到目标值，比如 100 nits 之后，RGB 那三个值又不在一条线上了。一方面跟显示器的素质有关，不能保证在亮度增减的同时保持 RGB 三个值的输出一致。另一方面也跟显示器预热有关，没到 30 分钟状态还不稳定。\n显示器校准的基本概念：Calibration 和 Profiling/Characterization。在使用 DisplayCAL 进行校准的时候，第一步就是通过显示器自身的调节按钮，比如显示器的 RGB 三通道值的输出，来与事先定义好的目标值匹配。调节显示器的亮度按钮使其达到比如 100 尼特；在色温选项里使用用户自定义的方式来调节 RGB 输出，使其达到比如 6500K 的色温（CCT）。这一步我们粗略的称之为校准 Calibration，需要人手动去调的。而第二步是软件自动实现的过程，叫做 Profiling，就是它会在屏幕上生成一系列色块，测量这些色块的值，与标准值进行匹配，然后生成一个 Profile (e.g. ICC profile) 给我们最终加载到系统上。Profiling 实际上并不改变颜色，它描述的是该显示器对各种颜色的响应，通常存储在一个 ICC 配置文件中。\nCharacterization (or profiling) is recording the way a device reproduces or responds to color. Typically the result is stored in a device ICC profile. Such a profile does not in itself modify color in any way. What it does is allow a system such as a CMM (Color Management Module) or color aware application to modify color when combined with another device profile. Only by knowing the characteristics of two devices or colorspaces, can a way of transferring color from one device representation to another be achieved.1\n之前在用 i1 Display Pro 这个色度计搭配 DisplayCAL 软件来校色的时候，校出来的结果你很难相信它是准确的。很多时候都是偏红偏黄。这当然是由很多因素导致的，每个显示器的素质不同，甚至同一型号的两台显示器也会是不同的结果。显示器面板老化等等。但有一点是之前比较忽略的，就是这个色度计这个探头本身是不是准的。\n色度计（Colorimeter）也需要在硬件或软件上进行校准2，以便从不同类型的显示器上获得正确的测量结果。色度计这个东西，一般是针对某一类或者某一个的显示设备，然后就专门用于那一类或那一个显示器的校准了，一般不用于其他显示器校准。因为当初是只针对那一个显示器做了色度计自身的硬件校准。如果色度计在最初，比如出厂前，没有针对某一类显示器做硬件校准。那么就需要使用光谱仪（Spectrometer）对那个显示器进行测量，计算出一个结果作为一个校准文件给搭配色度计使用的软件加载，这就是对色度计进行所谓的软件的校准。光谱仪（Spectrometer）据我所知非常昂贵，也不知道什么地方能搞到。但 DisplayCAL 官网有一个数据库3，里面就有别人使用光谱仪针对 i1 Display Pro 和各种显示器、监视器的校准文件。我们直接拿到那个校准文件也能用。但毕竟是别人在他们自己的那个设备上测量的结果，跟我们手上的显示器可能还是有一定偏差（虽然是同一型号的显示器）。我们可以在 DisplayCAL 软件里很方便的加载这个校准文件。\n那么即便有了这个对与色度计自身进行校准的文件，我们使用 6500K 色温作为目标值校准出来的结果，你放一个纯白出来，比如开一个文件资源管理器，也很难说这就是一个纯白。当然白色这个概念，人眼对于白的感知就挺主观的，而且是可以适应它的。但是在正常办公室光照条件下，那个屏幕摆在那你一眼看过去就是感觉它偏黄，这能怎么办呢。使用 i1 Display Pro 对 MacBook Pro 的屏幕进行测量会发现，它的色温是 7000K 左右。我们都知道 Rec.709 也好 sRGB 也好，白点都是 D65，也就是 6500K。为什么苹果 MBP 的屏幕是 7000K 的色温呢。我在我自己的 MBP 14 吋上，使用不同的显示预设（BT.709-BT.1886、sRGB、XDR-1600nits）测量出来的色温也都是 7000K 上下。我不知道是不是因为其实大多数用户，更偏好一个理论上更偏冷的屏幕（7000K），而不是一个标准的但肉眼看上去比较暖、比较黄的屏幕（6500K）。\n总之使用 7000K 的色温作为目标值，加载针对不同显示器的 i1 Display Pro 的校准文件，校准出来的结果是比较符合预期的。另外两个 Dell 的主副屏显示器，校准之前，两个屏幕有很明显的色差。使用 DisplayCAL 校准的时候，以 7000K 色温为目标值，先在显示器的 RGB 设置调节上，把 RGB 输出调到一条线上，然后点继续。等自动化的 Profiling 过程结束后，我们对比校准前和校准后，可以得到一个不错的匹配。副屏在校准之前，暗部区域比主屏要偏蓝偏青，然后感觉整个屏幕的饱和度都要比主屏高。校准之后有所改善。\nBenQ SW 系列的硬件校色功能 BenQ 的 SW 系列相比于 PD 系列具有硬件校色功能，使用 BenQ 的软件 Palette Master Element4 搭配 X-rite 的 i1 Display Pro 色度计可以让校色结果直接储存和加载到显示器本身，使用显示器自身芯片进行色彩校正。而不是像软件校色那样，校色结果储存在电脑，作用在显卡，然后将信号给到显示器。据明基 BenQ 所说，这种硬件校色的实现相比软件校色更优5。一款显示器的好坏与否，除了它自身的素质之外，有方便的机制可以让我们对其进行定期的校色，也是很重要的衡量因素。因此 BenQ SW270C 和 SW271C 具有的硬件校色功能是一个加分项。\n安装 Palette Master Element 软件时，会要求用 USB Type-B 线把显示器和电脑连接，然后会自动安装 BenQ 的驱动。安装好之后的使用和校准都需要保持显示器和电脑的 USB 连接。校准的设置并不多，总的分为两块：校准和验证。校准菜单下可设置的选项也不多，白点（D65），RGB 三原色（我们选 sRGB），亮度（我们设置为 80 尼特），伽马（2.2），黑点（绝对零位）。然后点击下一步。BenQ SW270C 提供三个校准的槽位，我们可以选择将校准 LUT 加载在可选的「校准 1」里，然后就可以开始测量了。把 i1 Display Pro 的探头贴在显示器的正中央，让软件运行，进行校准。校准 LUT 会自动加载。最后是验证校准的结果，也是跑一遍色块，最后得到校准的结果。Delta E。GSJ-9 我这次的校准结果的平均 Delta E 是 0.45，最带 Delta E 是 0.76。光看这个结果，数字上是非常不错的。理论上 Delta E 小于 2，人眼就很难看出区别了。\nCalibration vs. Characterization - ArgyllCMS\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nA note about colorimeters, displays and DisplayCAL - DisplayCAL\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nColorimeter Corrections Database - DisplayCAL\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nBenQ Palette Master Element Software - BenQ\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nHardware vs. Software Calibration Updated 2021 - BenQ\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://thomjiji.github.io/posts/2023/02/monitor-calibration-notes/","summary":"DisplayCAL 官网 User Guide 在对显示器校色之前，必须预热至少 30 分钟。这一点在我最近的校准过程中可以明确体会到，比如：在调整显示器自身的 RGB 输出时，当你把红绿蓝三个通道终于调到一条线上之后，这时亮度不达标了。调节显示器的亮度以达到目标值，比如 100 nits 之后，RGB 那三个值又不在一条线上了。一方面跟显示器的素质有关，不能保证在亮度增减的同时保持 RGB 三个值的输出一致。另一方面也跟显示器预热有关，没到 30 分钟状态还不稳定。\n显示器校准的基本概念：Calibration 和 Profiling/Characterization。在使用 DisplayCAL 进行校准的时候，第一步就是通过显示器自身的调节按钮，比如显示器的 RGB 三通道值的输出，来与事先定义好的目标值匹配。调节显示器的亮度按钮使其达到比如 100 尼特；在色温选项里使用用户自定义的方式来调节 RGB 输出，使其达到比如 6500K 的色温（CCT）。这一步我们粗略的称之为校准 Calibration，需要人手动去调的。而第二步是软件自动实现的过程，叫做 Profiling，就是它会在屏幕上生成一系列色块，测量这些色块的值，与标准值进行匹配，然后生成一个 Profile (e.g. ICC profile) 给我们最终加载到系统上。Profiling 实际上并不改变颜色，它描述的是该显示器对各种颜色的响应，通常存储在一个 ICC 配置文件中。\nCharacterization (or profiling) is recording the way a device reproduces or responds to color. Typically the result is stored in a device ICC profile. Such a profile does not in itself modify color in any way.","title":"显示器校色笔记"},{"content":"Installation mp4muxer mp4demuxer Commands 将 MP4 的音视频分离（脱壳 Demux）： mp4demuxer --input-file input.mp4 --output-folder ~/Output 合并杜比视界 Profile 8.4 和杜比全景声双音轨： mp4muxer \\ -i input.h265 \\ --input-video-frame-rate 25 \\ --hvc1flag 0 \\ --dv-bl-compatible-id 4 \\ -i Stereo.aac \\ -i Atmos.ec3 \\ -o DolbyVision_DolbyAtmos.mp4 合并 SDR 视频和杜比全景声双音轨: mp4muxer \\ -i input.h264 \\ --input-video-frame-rate 25 \\ -i Stereo.aac \\ -i Atmos.ec3 \\ -o SDR_DolbyAtmos.mp4 ","permalink":"https://thomjiji.github.io/posts/2023/01/mp4muxer-mp4demuxer-basic-usage/","summary":"Installation mp4muxer mp4demuxer Commands 将 MP4 的音视频分离（脱壳 Demux）： mp4demuxer --input-file input.mp4 --output-folder ~/Output 合并杜比视界 Profile 8.4 和杜比全景声双音轨： mp4muxer \\ -i input.h265 \\ --input-video-frame-rate 25 \\ --hvc1flag 0 \\ --dv-bl-compatible-id 4 \\ -i Stereo.aac \\ -i Atmos.ec3 \\ -o DolbyVision_DolbyAtmos.mp4 合并 SDR 视频和杜比全景声双音轨: mp4muxer \\ -i input.h264 \\ --input-video-frame-rate 25 \\ -i Stereo.aac \\ -i Atmos.ec3 \\ -o SDR_DolbyAtmos.mp4 ","title":"mp4muxer \u0026 mp4demuxer Basic Usage"},{"content":"操作步骤 将 ARRI Look Library 的 zip 解压，把里面的多个 cub 和 fllook 文件平摊到这个路径：/Library/Application Support/FilmLight/looks 将 ALF-2 v5 DRT Family 的 zip 解压，把里面的 cub 和 fltransform 平摊在这个路径：/Library/Application Support/FilmLight/etc/colourspaces 打开 Daylight，完成。 Reference ARRI Colour Workflow in Baselight ACES and Baselight ARRI Look Library and ALF-2 v5 DRT Family Download ","permalink":"https://thomjiji.github.io/posts/2023/01/daylight-add-arri-look-library/","summary":"操作步骤 将 ARRI Look Library 的 zip 解压，把里面的多个 cub 和 fllook 文件平摊到这个路径：/Library/Application Support/FilmLight/looks 将 ALF-2 v5 DRT Family 的 zip 解压，把里面的 cub 和 fltransform 平摊在这个路径：/Library/Application Support/FilmLight/etc/colourspaces 打开 Daylight，完成。 Reference ARRI Colour Workflow in Baselight ACES and Baselight ARRI Look Library and ALF-2 v5 DRT Family Download ","title":"Daylight 添加 ARRI Look Library \u0026 ALF-2 v5 DRT Family"},{"content":" Params Start at 39:56, Daniele introduced the method for rendering high quality H.264 in Baselight. Here is the key parameters:\nRate Control: CRF based VBR Quantizer: Nominal Quantizer parameter: 18 Quantizer parameter: 18 ","permalink":"https://thomjiji.github.io/posts/2022/12/hight-quality-h264-render-in-baselight/","summary":" Params Start at 39:56, Daniele introduced the method for rendering high quality H.264 in Baselight. Here is the key parameters:\nRate Control: CRF based VBR Quantizer: Nominal Quantizer parameter: 18 Quantizer parameter: 18 ","title":"High Quality H.264 Render in Baselight"},{"content":"Language Python, Rust\nLearning Machine Learning (How is it possible?) Rust system programming language (Yeah, I want to create compiled, binary programs. Rust is secure and fast.) Math (Calculus Recap) Python (Continuously learning and solidifying my Python skills by doing real projects) ","permalink":"https://thomjiji.github.io/about/","summary":"about me","title":"About me"}]